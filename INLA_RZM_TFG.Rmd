---
title: "INLA_RZM"
output:
  pdf_document: default
  html_document: default
---

```{r}
#install.packages("INLA",repos=c(getOption("repos"),INLA="https://inla.r-inla-download.org/R/stable"), dep=TRUE)
#inla.upgrade() # for the stable version
#inla.upgrade(testing=TRUE) # for the testing version
#if (!requireNamespace("BiocManager", quietly = TRUE))
  #install.packages("BiocManager")
#BiocManager::install(c("graph", "Rgraphviz"), dep=TRUE)
```


```{r}
library(devtools)
library("gpclib")
library("raster")
library("maptools")
library("broom")
library(mapproj)
gpclibPermit()
library(tidyr)
library(plyr)
library(dplyr)
library(readxl)
library(ggplot2)
library(ggthemes)
library(sf)
library(scales)
library(rgdal)
library(spdep) 
library(tmap)
library(tidyverse)
library(magick)
library(plotly)
library(tmaptools)
library(gridExtra)
library(RColorBrewer)
library(lattice)
library(INLA)
library(sqldf)
library(ggpubr)
library(MLmetrics)
```
```{r}

library(ggplot2)
fallecidos <- read.csv("fallecidos.csv", header = TRUE) 
head(fallecidos)

# Most basic bubble plot
p <- ggplot(fallecidos, aes(x= factor(Month, levels = c('Abr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec', 'Jan', 'Feb', 'Mar')), y=Fallecidos, group = 1)) +
  geom_point() +
  geom_line() + 
  labs(x = "Months", y = "Covid Deaths")
p

```

```{r}

library(ggplot2)
fallecidos <- read.csv("fallecidos2.csv", header = TRUE) 
head(fallecidos)

# Most basic bubble plot
p <- ggplot(fallecidos, aes(x= factor(Month, levels = c('Abr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec', 'Jan', 'Feb', 'Mar')), y=Fallecidos, group = 1)) +
  geom_point() +
  geom_line() + 
  labs(x = "Months", y = "Covid Deaths")
p

```



```{r}
to_upper <- function(x) toupper(chartr("áéíóúÁÉÍÓÚ", "aeiouAEIOU", x))

mapa_cantones <- read_sf("datosgeo/geo_data/cantones/cantones.shp")
head(mapa_cantones)
data1 <- read.csv("datos1.csv")
head(data1)
```


```{r}

to_upper <- function(x) toupper(chartr("áéíóúÁÉÍÓÚ", "aeiouAEIOU", x))
data <- read.csv("datostfgmarzo.csv")
head(data)
```

```{r}
mapa_cantones <- sf::st_transform(mapa_cantones, crs = "+proj=longlat +ellps=WGS84 +no_defs")
head(mapa_cantones)
```

```{r}
mapa_cantonestfg <- left_join(x = mapa_cantones,
                           y = data,
                           by = c("cant_nom2"="canton"))
head(mapa_cantonestfg)
```
```{r}
mapa_cantones2 <- left_join(x = mapa_cantones,
                           y = data1,
                           by = c("cant_nom2"="canton"))
head(mapa_cantones2)
```


```{r}
#### Construct the spatial objects
mapa_cantonestfg[rowSums(is.na(mapa_cantonestfg))!=0,]
mapa_cantonestfg2<-mapa_cantonestfg
```
```{r}
qtm(mapa_cantones2, "SMR")
tm_shape(mapa_cantones2) + tm_fill(col = "SMR")
qtm(mapa_cantones2, "falle.total.marzo", fill.palette="Reds")
```


```{r}
test <- st_is_valid(mapa_cantonestfg,reason=TRUE)
length(which(test!= "Valid Geometry"))
```


```{r}
st_crs(mapa_cantonestfg)

```

```{r}
nb <- poly2nb(mapa_cantonestfg$geometry)
head(nb)
```

```{r}
nb2INLA("map.adj", nb)
g<-inla.read.graph(filename = "map.adj")
```

```{r}
control <-list(
predictor =list(compute =TRUE),
compute =list(hyperpar=TRUE, return.marginals=TRUE, dic=TRUE, waic=TRUE, graph=TRUE, cpo =TRUE, openmp.strategy="huge"),
results =list(return.marginals.random = TRUE, return.marginals.predictor = TRUE),
group =list(model="rw2"))

prec_period <- list(c(1, 0.00040145), c(1, 0.00160580), c(1,0.04014488), c(1, 0.00005))
prec_space <- list(c(1, 0.00048684), c(1, 0.00194738), c(1, 0.04868439), c(1, 0.00005))
prec_interact <- list(c(1, 0.00078138), c(1, 0.00312552), c(1, 0.07813805), c(1, 0.00005))
prec_interact2 <- list(c(1,0.00040145), c(1, 0.00160580), c(1, 0.04014488), c(1, 0.00005))
```



#Check if model has linear trend or non-linear

#Linear
```{r}

mapa_cantonestfg2$SMR2<-mapa_cantonestfg2$SMR.anterior
formula<-fallecidos ~ SMR.anterior +f(SMR2, model="linear")
modelt0 =inla(formula = formula, family ="poisson", quantiles =c(.05, .5, .95), data = mapa_cantonestfg2, control.compute = control$compute,
control.predictor = control$predictor)
summary(modelt0)
plot(modelt0$cpo$cpo)
sum(-log(modelt0$cpo$cpo))
RMSE(mapa_cantonestfg2$fallecidos, modelt0$summary.fitted.values$mean)
```



#non-linear trend
```{r}

formula<-fallecidos ~ SMR.anterior +f(SMR2, model="iid")
modelt1 =inla(formula = formula, family ="poisson", quantiles =c(.05, .5, .95), data = mapa_cantonestfg2, control.compute = control$compute,
control.predictor = control$predictor)
summary(modelt1)
plot(modelt1$cpo$cpo)
sum(-log(modelt1$cpo$cpo))
RMSE(mapa_cantonestfg2$fallecidos, modelt1$summary.fitted.values$mean)
```


```{r, error=TRUE}
m = get("inla.models", inla.get.inlaEnv())
m$latent$rw2$min.diff = NULL
assign("inla.models", m, inla.get.inlaEnv())


formula<-fallecidos ~ SMR.anterior +f(SMR2, model="rw2")
modelt2 =inla(formula = formula, family ="poisson", quantiles =c(.05, .5, .95), data = mapa_cantonestfg2, control.compute = control$compute,
control.predictor = control$predictor)
summary(modelt2)
plot(modelt2$cpo$cpo)
sum(-log(modelt2$cpo$cpo))
RMSE(mapa_cantonestfg2$fallecidos, modelt2$summary.fitted.values$mean)
```

```{r, error=TRUE}
#m = get("inla.models", inla.get.inlaEnv())
#m$latent$rw2$min.diff = NULL
#assign("inla.models", m, inla.get.inlaEnv())

formula<-fallecidos ~ SMR.anterior +f(SMR2, model="rw1")
modelt3 =inla(formula = formula, family ="poisson", quantiles =c(.05, .5, .95), data = mapa_cantonestfg2, control.compute = control$compute,
control.predictor = control$predictor)
summary(modelt3)
plot(modelt3$cpo$cpo)
sum(-log(modelt3$cpo$cpo))
# m = get("inla.models", inla.get.inlaEnv())
# m$latent$rw1$min.diff = NULL 
# assign("inla.models", m, inla.get.inlaEnv())
RMSE(mapa_cantonestfg2$fallecidos, modelt3$summary.fitted.values$mean)
```

```{r, error=TRUE}
formula<-fallecidos ~SMR.anterior +f(SMR2, model="ar1")
modelt4 =inla(formula = formula, family ="poisson", quantiles =c(.05, .5, .95), data = mapa_cantonestfg2, control.compute = control$compute,
control.predictor = control$predictor)
summary(modelt4)
plot(modelt4$cpo$cpo)
sum(-log(modelt4$cpo$cpo))

#m = get("inla.models", inla.get.inlaEnv())
#m$latent$crw2$min.diff = NULL
#assign("inla.models", m, inla.get.inlaEnv())

RMSE(mapa_cantonestfg2$fallecidos, modelt4$summary.fitted.values$mean)
```


```{r, error=TRUE}
formula<-fallecidos ~ SMR.anterior +f(SMR2, model="mec")
modelt5 =inla(formula = formula, family ="poisson", quantiles =c(.05, .5, .95), data = mapa_cantonestfg2, control.compute = control$compute,
control.predictor = control$predictor)
summary(modelt5)
plot(modelt5$cpo$cpo)
sum(-log(modelt5$cpo$cpo))
RMSE(mapa_cantonestfg2$fallecidos, modelt5$summary.fitted.values$mean)
```


```{r, error=TRUE}
formula<-fallecidos ~SMR.anterior +f(SMR2, model="meb")
modelt6 =inla(formula = formula, family ="poisson", quantiles =c(.05, .5, .95), data = mapa_cantonestfg2, control.compute = control$compute,
control.predictor = control$predictor)
summary(modelt6)
plot(modelt6$cpo$cpo)
sum(-log(modelt6$cpo$cpo))
RMSE(mapa_cantonestfg2$fallecidos, modelt6$summary.fitted.values$mean)
```

```{r, error=TRUE}
m = get("inla.models", inla.get.inlaEnv())
m$latent$crw2$min.diff = NULL
assign("inla.models", m, inla.get.inlaEnv())

formula<-fallecidos ~SMR.anterior +f(SMR2, model="crw2")
modelt7 =inla(formula = formula, family ="poisson", quantiles =c(.05, .5, .95), data = mapa_cantonestfg2, control.compute = control$compute,
control.predictor = control$predictor)
summary(modelt7)
plot(modelt7$cpo$cpo)
sum(-log(modelt7$cpo$cpo))

RMSE(mapa_cantonestfg2$fallecidos, modelt7$summary.fitted.values$mean)
```




#INLA testing


```{r, error=TRUE}
formula0 <- (fallecidos~SMR.anterior+
                             f(cod_canton, model="bym",graph=g) + 
                             f(strdia, model="rw2") +
                             f(unstrdia, model="iid"))
res0 <- inla(formula0, family = "poisson", data = mapa_cantonestfg2, E = Expected, control.compute = list(dic = T, waic=T, cpo=T, return.marginals.predictor=TRUE), control.predictor = list(compute = TRUE))
summary(res0)
sum(-log(res0$cpo$cpo))
RMSE(mapa_cantonestfg2$fallecidos, res0$summary.fitted.values$mean)
```


```{r, error=TRUE}
#names(inla.models()$likelihood)
formula0 <- (fallecidos~SMR.anterior+
                             f(cod_canton, model="bym",graph=g) + 
                             f(strdia, model="rw2") +
                             f(unstrdia, model="iid"))
res0 <- inla(formula0, family = "nbinomial", data = mapa_cantonestfg2, E = Expected, control.compute = list(dic = T, waic=T, cpo=T, return.marginals.predictor=TRUE), control.predictor = list(compute = TRUE))
summary(res0)
sum(-log(res0$cpo$cpo))
RMSE(mapa_cantonestfg2$fallecidos, res0$summary.fitted.values$mean)

```

```{r, error=TRUE}
#names(inla.models()$likelihood)
formula0 <- (fallecidos~SMR.anterior+
                             f(cod_canton, model="bym",graph=g) + 
                             f(strdia, model="rw2") +
                             f(unstrdia, model="iid"))
res0 <- inla(formula0, family = "gaussian", data = mapa_cantonestfg2, E = Expected, control.compute = list(dic = T, waic=T, cpo=T, return.marginals.predictor=TRUE), control.predictor = list(compute = TRUE))
summary(res0)
sum(-log(res0$cpo$cpo))
RMSE(mapa_cantonestfg2$fallecidos, res0$summary.fitted.values$mean)

```

```{r, error=TRUE}
#names(inla.models()$likelihood)
formula0 <- (fallecidos~SMR.anterior+
                             f(cod_canton, model="bym",graph=g) + 
                             f(strdia, model="rw2") +
                             f(unstrdia, model="iid"))
res0 <- inla(formula0, family = "logistic", data = mapa_cantonestfg2, E = Expected, control.compute = list(dic = T, waic=T, cpo=T, return.marginals.predictor=TRUE), control.predictor = list(compute = TRUE))
summary(res0)
sum(-log(res0$cpo$cpo))
RMSE(mapa_cantonestfg2$fallecidos, res0$summary.fitted.values$mean)

```

```{r, error=TRUE}
#names(inla.models()$likelihood)
formula0 <- (fallecidos~SMR.anterior+
                             f(cod_canton, model="bym",graph=g) + 
                             f(strdia, model="rw2") +
                             f(unstrdia, model="iid"))
res0 <- inla(formula0, family = "zeroinflatedpoisson0", data = mapa_cantonestfg2, E = Expected, control.compute = list(dic = T, waic=T, cpo=T, return.marginals.predictor=TRUE), control.predictor = list(compute = TRUE))
summary(res0)
sum(-log(res0$cpo$cpo))
RMSE(mapa_cantonestfg2$fallecidos, res0$summary.fitted.values$mean)

```

```{r, error=TRUE}
#names(inla.models()$likelihood)
formula0 <- (fallecidos~SMR.anterior+
                             f(cod_canton, model="bym",graph=g) + 
                             f(strdia, model="rw2") +
                             f(unstrdia, model="iid"))
res0 <- inla(formula0, family = "zeroinflatedpoisson1", data = mapa_cantonestfg2, E = Expected, control.compute = list(dic = T, waic=T, cpo=T, return.marginals.predictor=TRUE), control.predictor = list(compute = TRUE))
summary(res0)
sum(-log(res0$cpo$cpo))
RMSE(mapa_cantonestfg2$fallecidos, res0$summary.fitted.values$mean)

```

```{r, error=TRUE}
#names(inla.models()$likelihood)
formula0 <- (fallecidos~SMR.anterior+
                             f(cod_canton, model="bym",graph=g) + 
                             f(strdia, model="rw2") +
                             f(unstrdia, model="iid"))
res0 <- inla(formula0, family = "zeroinflatedpoisson2", data = mapa_cantonestfg2, E = Expected, control.compute = list(dic = T, waic=T, cpo=T, return.marginals.predictor=TRUE), control.predictor = list(compute = TRUE))
summary(res0)
sum(-log(res0$cpo$cpo))
RMSE(mapa_cantonestfg2$fallecidos, res0$summary.fitted.values$mean)

```

```{r, error=TRUE}
#names(inla.models()$likelihood)
formula0 <- (fallecidos~SMR.anterior+
                             f(cod_canton, model="bym",graph=g) + 
                             f(strdia, model="rw2") +
                             f(unstrdia, model="iid"))
res0 <- inla(formula0, family = "zeroinflatednbinomial0", data = mapa_cantonestfg2, E = Expected, control.compute = list(dic = T, waic=T, cpo=T, return.marginals.predictor=TRUE), control.predictor = list(compute = TRUE))
summary(res0)
sum(-log(res0$cpo$cpo))
RMSE(mapa_cantonestfg2$fallecidos, res0$summary.fitted.values$mean)

```

```{r, error=TRUE}
#names(inla.models()$likelihood)
formula0 <- (fallecidos~SMR.anterior+
                             f(cod_canton, model="bym",graph=g) + 
                             f(strdia, model="rw2") +
                             f(unstrdia, model="iid"))
res0 <- inla(formula0, family = "zeroinflatednbinomial1", data = mapa_cantonestfg2, E = Expected, control.compute = list(dic = T, waic=T, cpo=T, return.marginals.predictor=TRUE), control.predictor = list(compute = TRUE))
summary(res0)
sum(-log(res0$cpo$cpo))
RMSE(mapa_cantonestfg2$fallecidos, res0$summary.fitted.values$mean)

```

```{r, error=TRUE}
#names(inla.models()$likelihood)
formula0 <- (fallecidos~SMR.anterior+
                             f(cod_canton, model="bym",graph=g) + 
                             f(strdia, model="rw2") +
                             f(unstrdia, model="iid"))
res0 <- inla(formula0, family = "zeroinflatednbinomial1strata2", data = mapa_cantonestfg2, E = Expected, control.compute = list(dic = T, waic=T, cpo=T, return.marginals.predictor=TRUE), control.predictor = list(compute = TRUE))
summary(res0)
sum(-log(res0$cpo$cpo))
RMSE(mapa_cantonestfg2$fallecidos, res0$summary.fitted.values$mean)

```
 
##Offset
```{r, error=TRUE}
formula0 <- (fallecidos~offset(SMR.anterior)+
                             f(cod_canton, model="bym",graph=g) + 
                             f(strdia, model="rw2") +
                             f(unstrdia, model="iid"))
res0 <- inla(formula0, family = "poisson", data = mapa_cantonestfg2, E = Expected, control.compute = list(dic = T, waic=T, cpo=T, return.marginals.predictor=TRUE), control.predictor = list(compute = TRUE))
summary(res0)
sum(-log(res0$cpo$cpo))
RMSE(mapa_cantonestfg2$fallecidos, res0$summary.fitted.values$mean)
```


```{r, error=TRUE}
#names(inla.models()$likelihood)
formula0 <- (fallecidos~offset(SMR.anterior)+
                             f(cod_canton, model="bym",graph=g) + 
                             f(strdia, model="rw2") +
                             f(unstrdia, model="iid"))
res0 <- inla(formula0, family = "nbinomial", data = mapa_cantonestfg2, E = Expected, control.compute = list(dic = T, waic=T, cpo=T, return.marginals.predictor=TRUE), control.predictor = list(compute = TRUE))
summary(res0)
sum(-log(res0$cpo$cpo))
RMSE(mapa_cantonestfg2$fallecidos, res0$summary.fitted.values$mean)

```

```{r, error=TRUE}
#names(inla.models()$likelihood)
formula0 <- (fallecidos~offset(SMR.anterior)+
                             f(cod_canton, model="bym",graph=g) + 
                             f(strdia, model="rw2") +
                             f(unstrdia, model="iid"))
res0 <- inla(formula0, family = "gaussian", data = mapa_cantonestfg2, E = Expected, control.compute = list(dic = T, waic=T, cpo=T, return.marginals.predictor=TRUE), control.predictor = list(compute = TRUE))
summary(res0)
sum(-log(res0$cpo$cpo))
RMSE(mapa_cantonestfg2$fallecidos, res0$summary.fitted.values$mean)

```

```{r, error=TRUE}
#names(inla.models()$likelihood)
formula0 <- (fallecidos~offset(SMR.anterior)+
                             f(cod_canton, model="bym",graph=g) + 
                             f(strdia, model="rw2") +
                             f(unstrdia, model="iid"))
res0 <- inla(formula0, family = "logistic", data = mapa_cantonestfg2, E = Expected, control.compute = list(dic = T, waic=T, cpo=T, return.marginals.predictor=TRUE), control.predictor = list(compute = TRUE))
summary(res0)
sum(-log(res0$cpo$cpo))
RMSE(mapa_cantonestfg2$fallecidos, res0$summary.fitted.values$mean)

```

```{r, error=TRUE}
#names(inla.models()$likelihood)
formula0 <- (fallecidos~offset(SMR.anterior)+
                             f(cod_canton, model="bym",graph=g) + 
                             f(strdia, model="rw2") +
                             f(unstrdia, model="iid"))
res0 <- inla(formula0, family = "zeroinflatedpoisson0", data = mapa_cantonestfg2, E = Expected, control.compute = list(dic = T, waic=T, cpo=T, return.marginals.predictor=TRUE), control.predictor = list(compute = TRUE))
summary(res0)
sum(-log(res0$cpo$cpo))
RMSE(mapa_cantonestfg2$fallecidos, res0$summary.fitted.values$mean)

```

```{r, error=TRUE}
#names(inla.models()$likelihood)
formula0 <- (fallecidos~offset(SMR.anterior)+
                             f(cod_canton, model="bym",graph=g) + 
                             f(strdia, model="rw2") +
                             f(unstrdia, model="iid"))
res0 <- inla(formula0, family = "zeroinflatedpoisson1", data = mapa_cantonestfg2, E = Expected, control.compute = list(dic = T, waic=T, cpo=T, return.marginals.predictor=TRUE), control.predictor = list(compute = TRUE))
summary(res0)
sum(-log(res0$cpo$cpo))
RMSE(mapa_cantonestfg2$fallecidos, res0$summary.fitted.values$mean)

```

```{r, error=TRUE}
#names(inla.models()$likelihood)
formula0 <- (fallecidos~offset(SMR.anterior)+
                             f(cod_canton, model="bym",graph=g) + 
                             f(strdia, model="rw2") +
                             f(unstrdia, model="iid"))
res0 <- inla(formula0, family = "zeroinflatedpoisson2", data = mapa_cantonestfg2, E = Expected, control.compute = list(dic = T, waic=T, cpo=T, return.marginals.predictor=TRUE), control.predictor = list(compute = TRUE))
summary(res0)
sum(-log(res0$cpo$cpo))
RMSE(mapa_cantonestfg2$fallecidos, res0$summary.fitted.values$mean)

```

```{r, error=TRUE}
#names(inla.models()$likelihood)
formula0 <- (fallecidos~offset(SMR.anterior)+
                             f(cod_canton, model="bym",graph=g) + 
                             f(strdia, model="rw2") +
                             f(unstrdia, model="iid"))
res0 <- inla(formula0, family = "zeroinflatednbinomial0", data = mapa_cantonestfg2, E = Expected, control.compute = list(dic = T, waic=T, cpo=T, return.marginals.predictor=TRUE), control.predictor = list(compute = TRUE))
summary(res0)
sum(-log(res0$cpo$cpo))
RMSE(mapa_cantonestfg2$fallecidos, res0$summary.fitted.values$mean)

```

```{r, error=TRUE}
#names(inla.models()$likelihood)
formula0 <- (fallecidos~offset(SMR.anterior)+
                             f(cod_canton, model="bym",graph=g) + 
                             f(strdia, model="rw2") +
                             f(unstrdia, model="iid"))
res0 <- inla(formula0, family = "zeroinflatednbinomial1", data = mapa_cantonestfg2, E = Expected, control.compute = list(dic = T, waic=T, cpo=T, return.marginals.predictor=TRUE), control.predictor = list(compute = TRUE))
summary(res0)
sum(-log(res0$cpo$cpo))
RMSE(mapa_cantonestfg2$fallecidos, res0$summary.fitted.values$mean)

```

```{r, error=TRUE}
#names(inla.models()$likelihood)
formula0 <- (fallecidos~offset(SMR.anterior)+
                             f(cod_canton, model="bym",graph=g) + 
                             f(strdia, model="rw2") +
                             f(unstrdia, model="iid"))
res0 <- inla(formula0, family = "zeroinflatednbinomial1strata2", data = mapa_cantonestfg2, E = Expected, control.compute = list(dic = T, waic=T, cpo=T, return.marginals.predictor=TRUE), control.predictor = list(compute = TRUE))
summary(res0)
sum(-log(res0$cpo$cpo))
RMSE(mapa_cantonestfg2$fallecidos, res0$summary.fitted.values$mean)

```
 









##Interaction type

#M1
```{r, error=TRUE}
formula1 <- (fallecidos~1)
res1 <- inla(formula1, family = "nbinomial",data=mapa_cantonestfg2,E=Expected, 
                 control.predictor=list(compute=TRUE), 
                 control.compute=list(dic=TRUE,cpo=TRUE,waic=TRUE),control.inla=list(strategy="laplace"))
summary(res1)
plot(res1$cpo$cpo)
sum(-log(res1$cpo$cpo))
RMSE(mapa_cantonestfg2$fallecidos, res1$summary.fitted.values$mean)
```
#M2
```{r, error=TRUE}
formula2 <- (fallecidos~SMR.anterior)
res2 <- inla(formula2, family = "nbinomial",data=mapa_cantonestfg2,E=Expected, 
                 control.predictor=list(compute=TRUE), 
                 control.compute=list(dic=TRUE,cpo=TRUE,waic=TRUE),control.inla=list(strategy="laplace"))
summary(res2)
plot(res2$cpo$cpo)
sum(-log(res2$cpo$cpo))
RMSE(mapa_cantonestfg2$fallecidos, res2$summary.fitted.values$mean)
```
#M3
```{r, error=TRUE}
formula3 <- (fallecidos~SMR.anterior + f(numcanton,model="bym", graph=g,hyper = prec_space) +
  f(strmes,model="rw2",hyper = prec_period) + f(unstrmes,model="iid") + f(mescanton,model="iid",hyper = prec_interact))
res3 <- inla(formula3, family = "nbinomial", data = mapa_cantonestfg, E = Expected, control.compute = list(dic = T, waic=T, cpo=T, return.marginals.predictor=TRUE), control.predictor = list(compute = TRUE),control.inla=list(strategy="laplace"))
summary(res3)
plot(res2$cpo$cpo)
sum(-log(res3$cpo$cpo))
```
```{r}
RMSE(mapa_cantonestfg2$fallecidos, res3$summary.fitted.values$mean)
```



#M4
```{r, error=TRUE}
formula4 <- (fallecidos~SMR.anterior +
                             f(numcanton, model="bym",graph=g, hyper = prec_interact) + 
                             f(strdia, model="rw2") +
                             f(unstrdia, model="iid", hyper = prec_interact))
res4 <- inla(formula4, family = "nbinomial", data = mapa_cantonestfg, E = Expected, control.compute = list(dic = T, waic=T, cpo=T, return.marginals.predictor=TRUE), control.predictor = list(compute = TRUE),control.inla=list(strategy="laplace"))
summary(res4)
plot(res4$cpo$cpo)
sum(-log(res4$cpo$cpo))
```
```{r}
RMSE(mapa_cantonestfg2$fallecidos, res4$summary.fitted.values$mean)
```



#Type I
#M5
```{r, error=TRUE}
formula5 <- (fallecidos~SMR.anterior+
                             f(numcanton, model="bym",graph=g) + 
                             f(strdia, model="rw2") +
                             f(unstrdia, model="iid")+
                              f(diacanton, model="iid"))
res5 <- inla(formula5, family = "nbinomial", data = mapa_cantonestfg, E = Expected, control.compute = list(dic = T, waic=T, cpo=T, return.marginals.predictor=TRUE), control.predictor = list(compute = TRUE),control.inla=list(strategy="laplace"))
summary(res5)
plot(res5$cpo$cpo)
sum(-log(res5$cpo$cpo))
```
```{r}
RMSE(mapa_cantonestfg2$fallecidos, res5$summary.fitted.values$mean)
```



#Type II
#M6
```{r, error = TRUE}

numcanton2 <- mapa_cantonestfg2$numcanton
strdia2 <- mapa_cantonestfg2$strdia
formula62 <- (fallecidos~SMR.anterior+
                             f(numcanton, model="bym",graph=g) + 
                             f(strdia, model="rw2") +
                             f(strdiaint, model="iid")+
                              f(numcanton2, model="iid", group=strdia2,
                               control.group=list(model="rw2")))
res62 <- inla(formula62, family = "nbinomial", data = mapa_cantonestfg, E = Expected, control.compute = list(dic = T, waic=T, cpo=T, return.marginals.predictor=TRUE), control.predictor = list(compute = TRUE),control.inla=list(strategy="laplace"))
summary(res62)
```

```{r}
plot(res62$cpo$cpo)
sum(-log(res62$cpo$cpo))
```
```{r}
RMSE(mapa_cantonestfg2$fallecidos, res62$summary.fitted.values$mean)
```



#Type III
#M7
```{r, error = TRUE}
formula7 <- (fallecidos~SMR.anterior+
                             f(numcanton, model="bym",graph=g) + 
                             f(strdia, model="rw2") +
                             f(strdiaint, model="iid")+
                              f(unstrdia, model="iid", group=numcanton2,
                               control.group=list(model="besag", graph=g)))


res7 <- inla(formula7, family = "nbinomial", data = mapa_cantonestfg, E = Expected, control.compute = list(dic = T, waic=T, cpo=T, return.marginals.predictor=TRUE), control.predictor = list(compute = TRUE), verbose=TRUE)
summary(res7)
plot(res7$cpo$cpo)
sum(-log(res7$cpo$cpo))
RMSE(mapa_cantonestfg2$fallecidos, res7$summary.fitted.values$mean)
```

#Type IV
#M8
```{r, error = TRUE}
formula8 <- (fallecidos~SMR.anterior+
                             f(numcanton, model="bym",graph=g) + 
                             f(strdia, model="rw2") +
                             f(strdiaint, model="iid")+
                              f(numcanton2, model="besag", graph=g, group=strdiaint,
                               control.group=list(model="rw2")))

res8 <- inla(formula8, family = "nbinomial", data = mapa_cantonestfg, E = Expected, control.compute = list(dic = T, waic=T, cpo=T, return.marginals.predictor=TRUE), control.predictor = list(compute = TRUE))
summary(res8)
plot(res8$cpo$cpo)
sum(-log(res8$cpo$cpo))
```
```{r, error = TRUE}
sum(-log(res8$cpo$cpo))
RMSE(mapa_cantonestfg2$fallecidos, res8$summary.fitted.values$mean)
```


#Type I
#M9
```{r, error = TRUE}
formula9 <- (fallecidos~SMR.anterior+
                             f(numcanton, model="bym",graph=g) + 
                             f(strmes, model="rw2") +
                             f(unstrmes, model="iid")+
                              f(numcanton2, model="iid"))

res9 <- inla(formula9, family = "nbinomial", data = mapa_cantonestfg, E = Expected, control.compute = list(dic = T, waic=T, cpo=T, return.marginals.predictor=TRUE), control.predictor = list(compute = TRUE))
summary(res9)
plot(res9$cpo$cpo)
sum(-log(res9$cpo$cpo))
```
```{r, error = TRUE}
RMSE(mapa_cantonestfg2$fallecidos, res9$summary.fitted.values$mean)
```

#Type II
#M10
```{r, error = TRUE}
formula10 <- (fallecidos~SMR.anterior+
                             f(numcanton, model="bym",graph=g) + 
                             f(strmes, model="rw2") +
                             f(unstrmes, model="iid")+
                            f(numcanton2, model="iid", group=strmesint,
                               control.group=list(model="rw2")))

res10 <- inla(formula10, family = "nbinomial", data = mapa_cantonestfg, control.compute = list(dic = T, waic=T, cpo=T, return.marginals.predictor=TRUE), control.predictor = list(compute = TRUE))
summary(res10)
plot(res10$cpo$cpo)
sum(-log(res10$cpo$cpo))
```
```{r, error = TRUE}
RMSE(mapa_cantonestfg2$fallecidos, res10$summary.fitted.values$mean)
```



#Type III
#M11
```{r, error = TRUE}
formula11 <- (fallecidos~SMR.anterior+
                             f(numcanton, model="bym",graph=g) + 
                             f(strmes, model="rw2") +
                             f(unstrmes, model="iid")+
                            f(unstrmesint, model="iid", group=numcanton2,
                               control.group=list(model="besag", graph=g)))

res11 <- inla(formula11, family = "nbinomial", data = mapa_cantonestfg, E = Expected, control.compute = list(dic = T, waic=T, cpo=T, return.marginals.predictor=TRUE), control.predictor = list(compute = TRUE), verbose=T)
summary(res11)
plot(res11$cpo$cpo)
sum(-log(res11$cpo$cpo))
```

#Type IV
#M12
```{r, error = TRUE}
formula12 <- (fallecidos~SMR.anterior+
                             f(numcanton, model="bym",graph=g) + 
                             f(strmes, model="rw2") +
                             f(unstrmes, model="iid")+
                            f(numcanton2, model="besag", graph=g, group = strmesint,
                               control.group=list(model="rw2")))

res12 <- inla(formula12, family = "nbinomial", data = mapa_cantonestfg, E = Expected, control.compute = list(dic = T, waic=T, cpo=T, return.marginals.predictor=TRUE), control.predictor = list(compute = TRUE))
summary(res12)
plot(res12$cpo$cpo)
sum(-log(res12$cpo$cpo))
```
```{r}
RMSE(mapa_cantonestfg2$fallecidos, res12$summary.fitted.values$mean)
```



#Correlation
```{r, error=TRUE}
x <- data[, c("porcentajeadltmayor", "IDH2018", "porcentajeurbano", "EVI_month",	"MIR_month",	"NIR_month",	"NDVI_month",	"LASTDia_month",	"LSTNoche_month", "SMR.anterior", "positivos.mes.anterior", "positivos.2mes.anterior", "fallecidos.anterior")]

cor(x, method = c("pearson", "kendall", "spearman"))

res <- cor(x)
round(res, 2)

library(corrplot)
corrplot(res, type = "upper", order = "hclust", 
         tl.col = "black", tl.srt = 45)

library("PerformanceAnalytics")

chart.Correlation(x, histogram=TRUE, pch=19)

col<- colorRampPalette(c("blue", "white", "red"))(20)
heatmap(x = res, col = col, symm = TRUE)
```


#Variables

#M6
#fallecidos
```{r, error = TRUE}

formulafallecidos <- (fallecidos~SMR.anterior+fallecidos.anterior+
                             f(numcanton, model="bym",graph=g) + 
                             f(strdia, model="rw2", hyper = prec_period) +
                             f(strdiaint, model="iid")+
                              f(numcanton2, model="iid", group=strdia2,
                               control.group=list(model="rw2")))
resfallecidos <- inla(formulafallecidos, family = "nbinomial", data = mapa_cantonestfg, E = Expected, control.compute = list(dic = T, waic=T, cpo=T, return.marginals.predictor=TRUE), control.predictor = list(compute = TRUE),control.inla=list(strategy="laplace"))
summary(resfallecidos)
plot(resfallecidos$cpo$cpo)
sum(-log(resfallecidos$cpo$cpo))
RMSE(mapa_cantonestfg2$fallecidos, resfallecidos$summary.fitted.values$mean)
```


#M6
#porcentajeadltmayor
```{r, error = TRUE}

formulaporcentajeadltmayor <- (fallecidos~SMR.anterior+porcentajeadltmayor+
                             f(numcanton, model="bym",graph=g) + 
                             f(strdia, model="rw2", hyper = prec_period) +
                             f(strdiaint, model="iid")+
                              f(numcanton2, model="iid", group=strdia2,
                               control.group=list(model="rw2")))
resporcentajeadltmayor <- inla(formulaporcentajeadltmayor, family = "nbinomial", data = mapa_cantonestfg, E = Expected, control.compute = list(dic = T, waic=T, cpo=T, return.marginals.predictor=TRUE), control.predictor = list(compute = TRUE),control.inla=list(strategy="laplace"))
summary(resporcentajeadltmayor)
plot(resporcentajeadltmayor$cpo$cpo)
sum(-log(resporcentajeadltmayor$cpo$cpo))

RMSE(mapa_cantonestfg2$fallecidos, resporcentajeadltmayor$summary.fitted.values$mean)
```



#M6
#IDH2018
```{r, error = TRUE}

formulaIDH2018 <- (fallecidos~SMR.anterior+IDH2018+
                             f(numcanton, model="bym",graph=g) + 
                             f(strdia, model="rw2", hyper = prec_period) +
                             f(strdiaint, model="iid")+
                              f(numcanton2, model="iid", group=strdia2,
                               control.group=list(model="rw2")))
resIDH2018 <- inla(formulaIDH2018, family = "nbinomial", data = mapa_cantonestfg, E = Expected, control.compute = list(dic = T, waic=T, cpo=T, return.marginals.predictor=TRUE), control.predictor = list(compute = TRUE),control.inla=list(strategy="laplace"))
summary(resIDH2018)
plot(resIDH2018$cpo$cpo)
sum(-log(resIDH2018$cpo$cpo))

RMSE(mapa_cantonestfg2$fallecidos, resIDH2018$summary.fitted.values$mean)
```


#porcentajeurbano
```{r, error = TRUE}

formulaporcentajeurbano <- (fallecidos~SMR.anterior+porcentajeurbano+
                             f(numcanton, model="bym",graph=g) + 
                             f(strdia, model="rw2", hyper = prec_period) +
                             f(strdiaint, model="iid")+
                              f(numcanton2, model="iid", group=strdia2,
                               control.group=list(model="rw2")))
resporcentajeurbano <- inla(formulaporcentajeurbano, family = "nbinomial", data = mapa_cantonestfg, E = Expected, control.compute = list(dic = T, waic=T, cpo=T, return.marginals.predictor=TRUE), control.predictor = list(compute = TRUE),control.inla=list(strategy="laplace"))
summary(resporcentajeurbano)
plot(resporcentajeurbano$cpo$cpo)
sum(-log(resporcentajeurbano$cpo$cpo))
```
```{r}
RMSE(mapa_cantonestfg2$fallecidos, resporcentajeurbano$summary.fitted.values$mean)
```


#EVI_month
```{r, error = TRUE}

formulaEVI_month <- (fallecidos~SMR.anterior+EVI_month+
                             f(numcanton, model="bym",graph=g) + 
                             f(strdia, model="rw2", hyper = prec_period) +
                             f(strdiaint, model="iid")+
                              f(numcanton2, model="iid", group=strdia2,
                               control.group=list(model="rw2")))
resEVI_month<- inla(formulaEVI_month, family = "nbinomial", data = mapa_cantonestfg, E = Expected, control.compute = list(dic = T, waic=T, cpo=T, return.marginals.predictor=TRUE), control.predictor = list(compute = TRUE),control.inla=list(strategy="laplace"))
summary(resEVI_month)
plot(resEVI_month$cpo$cpo)
sum(-log(resEVI_month$cpo$cpo))

RMSE(mapa_cantonestfg2$fallecidos, resEVI_month$summary.fitted.values$mean)
```


#MIR_month
```{r, error = TRUE}

formulaMIR_month <- (fallecidos~SMR.anterior+MIR_month+
                             f(numcanton, model="bym",graph=g) + 
                             f(strdia, model="rw2", hyper = prec_period) +
                             f(strdiaint, model="iid")+
                              f(numcanton2, model="iid", group=strdia2,
                               control.group=list(model="rw2")))
resMIR_month<- inla(formulaMIR_month, family = "nbinomial", data = mapa_cantonestfg, E = Expected, control.compute = list(dic = T, waic=T, cpo=T, return.marginals.predictor=TRUE), control.predictor = list(compute = TRUE),control.inla=list(strategy="laplace"))
summary(resMIR_month)
plot(resMIR_month$cpo$cpo)
sum(-log(resMIR_month$cpo$cpo))

RMSE(mapa_cantonestfg2$fallecidos, resMIR_month$summary.fitted.values$mean)
```



#NIR_month
```{r, error = TRUE}

formulaNIR_month <- (fallecidos~SMR.anterior+NIR_month+
                             f(numcanton, model="bym",graph=g) + 
                             f(strdia, model="rw2", hyper = prec_period) +
                             f(strdiaint, model="iid")+
                              f(numcanton2, model="iid", group=strdia2,
                               control.group=list(model="rw2")))
resNIR_month<- inla(formulaNIR_month, family = "nbinomial", data = mapa_cantonestfg, E = Expected, control.compute = list(dic = T, waic=T, cpo=T, return.marginals.predictor=TRUE), control.predictor = list(compute = TRUE),control.inla=list(strategy="laplace"))
summary(resNIR_month)
plot(resNIR_month$cpo$cpo)
sum(-log(resNIR_month$cpo$cpo))

RMSE(mapa_cantonestfg2$fallecidos, resNIR_month$summary.fitted.values$mean)
```



#NDVI_month
```{r, error = TRUE}

formulaNDVI_month <- (fallecidos~SMR.anterior+NDVI_month+
                             f(numcanton, model="bym",graph=g) + 
                             f(strdia, model="rw2", hyper = prec_period) +
                             f(strdiaint, model="iid")+
                              f(numcanton2, model="iid", group=strdia2,
                               control.group=list(model="rw2")))
resNDVI_month<- inla(formulaNDVI_month, family = "nbinomial", data = mapa_cantonestfg, E = Expected, control.compute = list(dic = T, waic=T, cpo=T, return.marginals.predictor=TRUE), control.predictor = list(compute = TRUE),control.inla=list(strategy="laplace"))
summary(resNDVI_month)
plot(resNDVI_month$cpo$cpo)
sum(-log(resNDVI_month$cpo$cpo))

RMSE(mapa_cantonestfg2$fallecidos, resNDVI_month$summary.fitted.values$mean)
```

#LASTDia_month
```{r, error = TRUE}

formulaLASTDia_month <- (fallecidos~SMR.anterior+LASTDia_month+
                             f(numcanton, model="bym",graph=g) + 
                             f(strdia, model="rw2", hyper = prec_period) +
                             f(strdiaint, model="iid")+
                              f(numcanton2, model="iid", group=strdia2,
                               control.group=list(model="rw2")))
resLASTDia_month<- inla(formulaLASTDia_month, family = "nbinomial", data = mapa_cantonestfg, E = Expected, control.compute = list(dic = T, waic=T, cpo=T, return.marginals.predictor=TRUE), control.predictor = list(compute = TRUE),control.inla=list(strategy="laplace"))
summary(resLASTDia_month)
plot(resLASTDia_month$cpo$cpo)
sum(-log(resLASTDia_month$cpo$cpo))

RMSE(mapa_cantonestfg2$fallecidos, resLASTDia_month$summary.fitted.values$mean)
```

#LSTNoche_month
```{r, error = TRUE}

formulaLSTNoche_month <- (fallecidos~SMR.anterior+LSTNoche_month+
                             f(numcanton, model="bym",graph=g) + 
                             f(strdia, model="rw2", hyper = prec_period) +
                             f(strdiaint, model="iid")+
                              f(numcanton2, model="iid", group=strdia2,
                               control.group=list(model="rw2")))
resLSTNoche_month<- inla(formulaLSTNoche_month, family = "nbinomial", data = mapa_cantonestfg, E = Expected, control.compute = list(dic = T, waic=T, cpo=T, return.marginals.predictor=TRUE), control.predictor = list(compute = TRUE),control.inla=list(strategy="laplace"))
summary(resLSTNoche_month)
plot(resLSTNoche_month$cpo$cpo)
sum(-log(resLSTNoche_month$cpo$cpo))

RMSE(mapa_cantonestfg2$fallecidos, resLSTNoche_month$summary.fitted.values$mean)
```

#positivos.mes.anterior
```{r, error = TRUE}

formulaporcentajeadltmayor <- (fallecidos~SMR.anterior+positivos.mes.anterior+
                             f(numcanton, model="bym",graph=g) + 
                             f(strdia, model="rw2", hyper = prec_period) +
                             f(strdiaint, model="iid")+
                              f(numcanton2, model="iid", group=strdia2,
                               control.group=list(model="rw2")))
resporcentajeadltmayor <- inla(formulaporcentajeadltmayor, family = "nbinomial", data = mapa_cantonestfg, E = Expected, control.compute = list(dic = T, waic=T, cpo=T, return.marginals.predictor=TRUE), control.predictor = list(compute = TRUE),control.inla=list(strategy="laplace"))
summary(resporcentajeadltmayor)
plot(resporcentajeadltmayor$cpo$cpo)
sum(-log(resporcentajeadltmayor$cpo$cpo))

RMSE(mapa_cantonestfg2$fallecidos, resporcentajeadltmayor$summary.fitted.values$mean)
```


#positivos.2mes.anterior
```{r, error = TRUE}

formulaporcentajeadltmayor <- (fallecidos~SMR.anterior+positivos.2mes.anterior+
                             f(numcanton, model="bym",graph=g) + 
                             f(strdia, model="rw2", hyper = prec_period) +
                             f(strdiaint, model="iid")+
                              f(numcanton2, model="iid", group=strdia2,
                               control.group=list(model="rw2")))
resporcentajeadltmayor <- inla(formulaporcentajeadltmayor, family = "nbinomial", data = mapa_cantonestfg, E = Expected, control.compute = list(dic = T, waic=T, cpo=T, return.marginals.predictor=TRUE), control.predictor = list(compute = TRUE),control.inla=list(strategy="laplace"))
summary(resporcentajeadltmayor)
plot(resporcentajeadltmayor$cpo$cpo)
sum(-log(resporcentajeadltmayor$cpo$cpo))

RMSE(mapa_cantonestfg2$fallecidos, resporcentajeadltmayor$summary.fitted.values$mean)
```

##Combinacion 
#positivos.mes.anterior/positivos.2mes.anterior
```{r, error = TRUE}

formulapi <- (fallecidos~SMR.anterior+positivos.mes.anterior+positivos.2mes.anterior+
                             f(numcanton, model="bym",graph=g) +
                             f(strdia, model="rw2", hyper = prec_period) +
                             f(strdiaint, model="iid")+
                              f(numcanton2, model="iid", group=strdia2,
                               control.group=list(model="rw2")))
respi<- inla(formulapi, family = "nbinomial", data = mapa_cantonestfg, E = Expected, control.compute = list(dic = T, waic=T, cpo=T, return.marginals.predictor=TRUE), control.predictor = list(compute = TRUE),control.inla=list(strategy="laplace"))
summary(respi)
plot(respi$cpo$cpo)
sum(-log(respi$cpo$cpo))

RMSE(mapa_cantonestfg2$fallecidos, respi$summary.fitted.values$mean)
```


```{r, error = TRUE}
#numcanton2 <- mapa_cantonestfg2$numcanton

formulapi2 <- (fallecidos~SMR.anterior+positivos.mes.anterior+positivos.2mes.anterior+fallecidos.anterior+
                             f(numcanton, model="bym",graph=g) +
                             f(strdia, model="rw2", hyper = prec_period) +
                             f(strdiaint, model="iid")+
                              f(numcanton2, model="iid", group=strdia2,
                               control.group=list(model="rw2")))
respi2<- inla(formulapi2, family = "nbinomial", data = mapa_cantonestfg, E = Expected, control.compute = list(dic = T, waic=T, cpo=T, return.marginals.predictor=TRUE), control.predictor = list(compute = TRUE),control.inla=list(strategy="laplace"))
summary(respi2)
plot(respi2$cpo$cpo)
sum(-log(respi2$cpo$cpo))

RMSE(mapa_cantonestfg2$fallecidos, respi2$summary.fitted.values$mean)
```




```{r, error = TRUE}

formulapi4 <- (fallecidos~SMR.anterior+(positivos.mes.anterior)+(positivos.2mes.anterior)+offset(fallecidos.anterior)+
                             f(numcanton, model="bym",graph=g) +
                             f(strdia, model="rw2", hyper = prec_period) +
                             f(strdiaint, model="iid")+
                              f(numcanton2, model="iid", group=strdia2,
                               control.group=list(model="rw2")))
respi4<- inla(formulapi4, family = "nbinomial", data = mapa_cantonestfg, E = Expected, control.compute = list(dic = T, waic=T, cpo=T, return.marginals.predictor=TRUE), control.predictor = list(compute = TRUE),control.inla=list(strategy="laplace"))
summary(respi4)
plot(respi4$cpo$cpo)
sum(-log(respi4$cpo$cpo))

RMSE(mapa_cantonestfg2$fallecidos, respi4$summary.fitted.values$mean)
```

<!-- #porcentajeadltmayor/IDH2018 -->
<!-- ```{r, error = TRUE} -->

<!-- formulapi <- (fallecidos~SMR.anterior+porcentajeadltmayor+IDH2018+ -->
<!--                              f(numcanton, model="bym",graph=g) +  -->
<!--                              f(strdia, model="rw2", hyper = prec_period) + -->
<!--                              f(strdiaint, model="ar1")+ -->
<!--                               f(numcanton2, model="ar1", group=strdia2, -->
<!--                                control.group=list(model="rw2"))) -->
<!-- respi<- inla(formulapi, family = "poisson", data = mapa_cantonestfg, E = Expected, control.compute = list(dic = T, waic=T, cpo=T, return.marginals.predictor=TRUE), control.predictor = list(compute = TRUE),control.inla=list(strategy="laplace")) -->
<!-- summary(respi) -->
<!-- plot(respi$cpo$cpo) -->
<!-- sum(-log(respi$cpo$cpo)) -->
<!-- ``` -->

<!-- #porcentajeadltmayor/IDH2018 -->
<!-- ```{r, error = TRUE} -->

<!-- formulapi <- (fallecidos~SMR.anterior+porcentajeadltmayor+IDH2018+ -->
<!--                              f(numcanton, model="bym",graph=g) +  -->
<!--                              f(strdia, model="rw2", hyper = prec_period) + -->
<!--                              f(strdiaint, model="ar1")+ -->
<!--                               f(numcanton2, model="ar1", group=strdia2, -->
<!--                                control.group=list(model="rw2"))) -->
<!-- respi<- inla(formulapi, family = "poisson", data = mapa_cantonestfg, E = Expected, control.compute = list(dic = T, waic=T, cpo=T, return.marginals.predictor=TRUE), control.predictor = list(compute = TRUE),control.inla=list(strategy="laplace")) -->
<!-- summary(respi) -->
<!-- plot(respi$cpo$cpo) -->
<!-- sum(-log(respi$cpo$cpo)) -->
<!-- ``` -->

<!-- #porcentajeurbano/IDH2018 -->
<!-- ```{r, error = TRUE} -->

<!-- formulapui <- (fallecidos~SMR.anterior+porcentajeurbano+IDH2018+ -->
<!--                              f(numcanton, model="bym",graph=g) +  -->
<!--                              f(strdia, model="rw2", hyper = prec_period) + -->
<!--                              f(strdiaint, model="ar1")+ -->
<!--                               f(numcanton2, model="ar1", group=strdia2, -->
<!--                                control.group=list(model="rw2"))) -->
<!-- respui<- inla(formulapui, family = "poisson", data = mapa_cantonestfg, E = Expected, control.compute = list(dic = T, waic=T, cpo=T, return.marginals.predictor=TRUE), control.predictor = list(compute = TRUE),control.inla=list(strategy="laplace")) -->
<!-- summary(respui) -->
<!-- plot(respui$cpo$cpo) -->
<!-- sum(-log(respui$cpo$cpo)) -->
<!-- ``` -->

<!-- #EVI_month/NDVI_month -->
<!-- ```{r, error = TRUE} -->

<!-- formulaen <- (fallecidos~SMR.anterior+EVI_month+NDVI_month+ -->
<!--                              f(numcanton, model="bym",graph=g) +  -->
<!--                              f(strdia, model="rw2", hyper = prec_period) + -->
<!--                              f(strdiaint, model="ar1")+ -->
<!--                               f(numcanton2, model="ar1", group=strdia2, -->
<!--                                control.group=list(model="rw2"))) -->
<!-- resen<- inla(formulaen, family = "poisson", data = mapa_cantonestfg, E = Expected, control.compute = list(dic = T, waic=T, cpo=T, return.marginals.predictor=TRUE), control.predictor = list(compute = TRUE),control.inla=list(strategy="laplace")) -->
<!-- summary(resen) -->
<!-- plot(resen$cpo$cpo) -->
<!-- sum(-log(resen$cpo$cpo)) -->
<!-- ``` -->

<!-- #EVI_month/NIR_month -->
<!-- ```{r, error = TRUE} -->

<!-- formulaenn <- (fallecidos~SMR.anterior+EVI_month+NIR_month+ -->
<!--                              f(numcanton, model="bym",graph=g) +  -->
<!--                              f(strdia, model="rw2", hyper = prec_period) + -->
<!--                              f(strdiaint, model="ar1")+ -->
<!--                               f(numcanton2, model="ar1", group=strdia2, -->
<!--                                control.group=list(model="rw2"))) -->
<!-- resenn<- inla(formulaenn, family = "poisson", data = mapa_cantonestfg, E = Expected, control.compute = list(dic = T, waic=T, cpo=T, return.marginals.predictor=TRUE), control.predictor = list(compute = TRUE),control.inla=list(strategy="laplace")) -->
<!-- summary(resenn) -->
<!-- plot(resenn$cpo$cpo) -->
<!-- sum(-log(resenn$cpo$cpo)) -->
<!-- ``` -->


<!-- #NDVI_month/NIR_month -->
<!-- ```{r, error = TRUE} -->

<!-- formulaennn <- (fallecidos~SMR.anterior+NDVI_month+NIR_month+ -->
<!--                              f(numcanton, model="bym",graph=g) +  -->
<!--                              f(strdia, model="rw2", hyper = prec_period) + -->
<!--                              f(strdiaint, model="ar1")+ -->
<!--                               f(numcanton2, model="ar1", group=strdia2, -->
<!--                                control.group=list(model="rw2"))) -->
<!-- resennn<- inla(formulaennn, family = "poisson", data = mapa_cantonestfg, E = Expected, control.compute = list(dic = T, waic=T, cpo=T, return.marginals.predictor=TRUE), control.predictor = list(compute = TRUE),control.inla=list(strategy="laplace")) -->
<!-- summary(resennn) -->
<!-- plot(resennn$cpo$cpo) -->
<!-- sum(-log(resennn$cpo$cpo)) -->
<!-- ``` -->


<!-- #LASTDia_month/LSTNoche_month -->
<!-- ```{r, error = TRUE} -->

<!-- formulall <- (fallecidos~SMR.anterior+LASTDia_month+LSTNoche_month+ -->
<!--                              f(numcanton, model="bym",graph=g) +  -->
<!--                              f(strdia, model="rw2", hyper = prec_period) + -->
<!--                              f(strdiaint, model="ar1")+ -->
<!--                               f(numcanton2, model="ar1", group=strdia2, -->
<!--                                control.group=list(model="rw2"))) -->
<!-- resll<- inla(formulall, family = "poisson", data = mapa_cantonestfg, E = Expected, control.compute = list(dic = T, waic=T, cpo=T, return.marginals.predictor=TRUE), control.predictor = list(compute = TRUE),control.inla=list(strategy="laplace")) -->
<!-- summary(resll) -->
<!-- plot(resll$cpo$cpo) -->
<!-- sum(-log(resll$cpo$cpo)) -->
<!-- ``` -->


```{r, error=TRUE}
library(ggplot2)
marginal <- inla.smarginal(respi2$marginals.fixed$SMR.anterior)
marginal <- data.frame(marginal)
ggplot(marginal, aes(x = x, y = y)) + geom_line() +
labs(x = expression(beta[1]), y = "Density") +
geom_vline(xintercept = 0, col = "black") + theme_bw()
```


```{r, error=TRUE}
library(ggplot2)
marginal <- inla.smarginal(respi2$marginals.fixed$`(Intercept)`)
marginal <- data.frame(marginal)
ggplot(marginal, aes(x = x, y = y)) + geom_line() +
labs(x = expression(beta[1]), y = "Density") +
geom_vline(xintercept = 0, col = "black") + theme_bw()
```



```{r, error=TRUE}

mapa_cantonestfg2$respa <- respi2$summary.random$numcanton[mapa_cantonestfg2$numcanton, "mean"]

mapa_cantonestfg2$reiid <- respi2$summary.random$numcanton2[, "mean"]
tm_shape(mapa_cantonestfg2) +
tm_polygons(col = c("respa", "reiid"), style = "cont", border.col = "transparent") +
tm_shape(mapa_cantonestfg) + tm_borders() +
tm_facets(ncol = 2) + tm_legend(legend.position = c("left", "bottom"))
```

```{r, error=TRUE}
mapa_cantonestfg2$RR <- respi2$summary.fitted.values[, "mean"]
mapa_cantonestfg2$LL <- respi2$summary.fitted.values[, "0.025quant"]
mapa_cantonestfg2$UL <- respi2$summary.fitted.values[, "0.975quant"]

tm_shape(mapa_cantonestfg2) +
tm_polygons(col = c("RR", "LL", "UL"), style = 'fixed', border.col = "transparent",
breaks = c(0, 1, 5, 10, 50, 100)) +
tm_shape(mapa_cantonestfg2) + tm_borders() +
tm_facets(ncol = 3) + tm_legend(legend.position = c("left", "bottom"))
```


```{r, error=TRUE}
summary(respi2)
exp(respi2$summary.fixed)
-mean(log(respi2$cpo$cpo))
#brier.score(mapa_cantonestfg2[["fallecidos"]], res62[["summary.fitted.values"]])
goftest::cvm.test(respi2$cpo$pit, null="punif")
```


```{r, error=TRUE}
#exploring final model:
exp(respi2$summary.fixed)
summary(respi2)
```

```{r, error=TRUE}
plot(respi2$marginals.fixed$SMR, main="SMR", xlab="", ylab="", xlim=c(-0.75,0.75), yaxt='n',
type="l")
abline(v=0, col="red")
plot(respi2$marginals.fixed$`(Intercept)`, main="Intercept", xlim=c(-0.1,0.1), xlab="", ylab="",
yaxt='n', type="l")
abline(v=0, col="red")

```


```{r, error=TRUE}
mapa_cantonestfg2$RR <- respi2$summary.fitted.values[, "mean"]
mapa_cantonestfg2$LL <- respi2$summary.fitted.values[, "0.025quant"]
mapa_cantonestfg2$UL <- respi2$summary.fitted.values[, "0.975quant"]
newdata <- mapa_cantonestfg2[order(mapa_cantonestfg2$strdia, mapa_cantonestfg2$diacanton),]


newdataRRabr <- newdata[1:82,]
newdataRRmay <- newdata[83:164,]
newdataRRjun <- newdata[165:246,]
newdataRRjul <- newdata[247:328,]
newdataRRago <- newdata[329:410,]
newdataRRset <- newdata[411:492,]
newdataRRoct <- newdata[493:574,]
newdataRRnov <- newdata[575:656,]
newdataRRdec <- newdata[657:738,]
newdataRRene <- newdata[739:820,]
newdataRRfeb <- newdata[821:902,]
newdataRRmar <- newdata[903:984,]

par(mfrow=c(1,1))

tm_shape(newdataRRabr) +
tm_polygons(col = c("RR", "LL", "UL"), style = 'fixed', border.col = "transparent",
breaks = c(0, 1, 5, 10, 50, 100)) +
tm_shape(newdataRRmar) + tm_borders() +
tm_facets(ncol = 3) + tm_legend(legend.position = c("left", "bottom"), main.title= 'Abr 2020',  main.title.position = c('left', 'top'))


tm_shape(newdataRRmay) +
tm_polygons(col = c("RR", "LL", "UL"), style = 'fixed', border.col = "transparent",
breaks = c(0, 1, 5, 10, 50, 100)) +
tm_shape(newdataRRmay) + tm_borders() +
tm_facets(ncol = 3) + tm_legend(legend.position = c("left", "bottom"), main.title= 'May 2020',  main.title.position = c('left', 'top'))

tm_shape(newdataRRjun) +
tm_polygons(col = c("RR", "LL", "UL"), style = 'fixed', border.col = "transparent",
breaks = c(0, 1, 5, 10, 50, 100)) +
tm_shape(newdataRRjun) + tm_borders() +
tm_facets(ncol = 3) + tm_legend(legend.position = c("left", "bottom"), main.title= 'Jun 2020',  main.title.position = c('left', 'top'))

tm_shape(newdataRRjul) +
tm_polygons(col = c("RR", "LL", "UL"), style = 'fixed', border.col = "transparent",
breaks = c(0, 1, 5, 10, 50, 100)) +
tm_shape(newdataRRjul) + tm_borders() +
tm_facets(ncol = 3) + tm_legend(legend.position = c("left", "bottom"), main.title= 'Jul 2020',  main.title.position = c('left', 'top'))

tm_shape(newdataRRago) +
tm_polygons(col = c("RR", "LL", "UL"), style = 'fixed', border.col = "transparent",
breaks = c(0, 1, 5, 10, 50, 100)) +
tm_shape(newdataRRago) + tm_borders() +
tm_facets(ncol = 3) + tm_legend(legend.position = c("left", "bottom"), main.title= 'Ago 2020',  main.title.position = c('left', 'top'))

tm_shape(newdataRRset) +
tm_polygons(col = c("RR", "LL", "UL"), style = 'fixed', border.col = "transparent",
breaks = c(0, 1, 5, 10, 50, 100)) +
tm_shape(newdataRRset) + tm_borders() +
tm_facets(ncol = 3) + tm_legend(legend.position = c("left", "bottom"), main.title= 'Set 2020',  main.title.position = c('left', 'top'))

tm_shape(newdataRRoct) +
tm_polygons(col = c("RR", "LL", "UL"), style = 'fixed', border.col = "transparent",
breaks = c(0, 1, 5, 10, 50, 100)) +
tm_shape(newdataRRoct) + tm_borders() +
tm_facets(ncol = 3) + tm_legend(legend.position = c("left", "bottom"), main.title= 'Oct 2020',  main.title.position = c('left', 'top'))

tm_shape(newdataRRnov) +
tm_polygons(col = c("RR", "LL", "UL"), style = 'fixed', border.col = "transparent",
breaks = c(0, 1, 5, 10, 50, 100)) +
tm_shape(newdataRRnov) + tm_borders() +
tm_facets(ncol = 3) + tm_legend(legend.position = c("left", "bottom"), main.title= 'Nov 2020',  main.title.position = c('left', 'top'))

tm_shape(newdataRRdec) +
tm_polygons(col = c("RR", "LL", "UL"), style = 'fixed', border.col = "transparent",
breaks = c(0, 1, 5, 10, 50, 100)) +
tm_shape(newdataRRdec) + tm_borders() +
tm_facets(ncol = 3) + tm_legend(legend.position = c("left", "bottom"), main.title= 'Dec 2020',  main.title.position = c('left', 'top'))

tm_shape(newdataRRene) +
tm_polygons(col = c("RR", "LL", "UL"), style = 'fixed', border.col = "transparent",
breaks = c(0, 1, 5, 10, 50, 100)) +
tm_shape(newdataRRene) + tm_borders() +
tm_facets(ncol = 3) + tm_legend(legend.position = c("left", "bottom"), main.title= 'Ene 2021',  main.title.position = c('left', 'top'))

tm_shape(newdataRRfeb) +
tm_polygons(col = c("RR", "LL", "UL"), style = 'fixed', border.col = "transparent",
breaks = c(0, 1, 5, 10, 50, 100)) +
tm_shape(newdataRRfeb) + tm_borders() +
tm_facets(ncol = 3) + tm_legend(legend.position = c("left", "bottom"), main.title= 'Feb 2021',  main.title.position = c('left', 'top'))

tm_shape(newdataRRmar) +
tm_polygons(col = c("RR", "LL", "UL"), style = 'fixed', border.col = "transparent",
breaks = c(0, 1, 5, 10, 50, 100)) +
tm_shape(newdataRRmar) + tm_borders() +
tm_facets(ncol = 3) + tm_legend(legend.position = c("left", "bottom"), main.title= 'Mar 2021',  main.title.position = c('left', 'top'))
```


```{r, error=TRUE}
library(ggplot2)
marginal <- inla.smarginal(respi2$marginals.fixed$SMR)
marginal <- data.frame(marginal)
ggplot(marginal, aes(x = x, y = y)) + geom_line() +
labs(x = expression(beta[1]), y = "Density") +
geom_vline(xintercept = 0, col = "black") + theme_bw()


marginal <- inla.smarginal(respi2$marginals.fixed$`(Intercept)`)
marginal <- data.frame(marginal)
ggplot(marginal, aes(x = x, y = y)) + geom_line() +
labs(x = expression(beta[1]), y = "Density") +
geom_vline(xintercept = 0, col = "black") + theme_bw()
```


```{r, error=TRUE}
summary(respi2)
exp(respi2$summary.fixed)
-mean(log(respi2$cpo$cpo))
brierscore <-function(x, m){
with(m, {mean(x^2) -2 *mean(x *mean) +mean(mean^2 +sd^2)})
}
brierscore(mapa_cantonestfg2[["fallecidos"]], respi2[["summary.fitted.values"]])
goftest::cvm.test(respi2$cpo$pit, null="punif")
```

```{r}
new.speeds <- read.csv("datostfgpred.csv", header = TRUE) 
head(new.speeds)
```


```{r}
new.speeds <- left_join(x = mapa_cantones,
                           y = new.speeds,
                           by = c("cant_nom2"="canton"))
head(new.speeds)
```




#Type II
#M6

# numcanton2 <- new.speeds$numcanton
# strdia2 <- new.speeds$strdia
# formula63 <- (fallecidos~SMR.anterior+
#                              f(numcanton, model="bym",graph=g) +
#                              f(strdia, model="rw2") +
#                              f(strdiaint, model="ar1")+
#                               f(numcanton2, model="ar1", group=strdia2,
#                                control.group=list(model="rw2")))
# res63 <- inla(formula63, family = "poisson", data = new.speeds, E = Expected, control.compute = list(dic = T, waic=T, cpo=T, #return.marginals.predictor=TRUE), control.predictor = list(compute = TRUE),control.inla=list(strategy="laplace"))
# summary(res63)

# plot(res63$cpo$cpo)
# sum(-log(res63$cpo$cpo))




#RMSE(mapa_cantonestfg2$fallecidos, resfallecidos$summary.fitted.values$mean)





```{r}
# mapa_cantonestfg2.pred <- rbind(mapa_cantonestfg2, 
#   data.frame(fallecidos = rep(NA, 82), strdia=13))


numcanton2.pred <- new.speeds$numcanton.pred
strdia2.pred <- new.speeds$strdia.pred
formula62.pred <- (fallecidos.pred~SMR.anterior.pred+positivos.mes.anterior+positivos.2mes.anterior+fallecidos.anterior+
                             f(numcanton.pred, model="bym",graph=g) +
                             f(strdia.pred, model="rw2") +
                             f(strdiaint.pred, model="iid")+
                              f(numcanton2.pred, model="iid", group=strdia2.pred,
                               control.group=list(model="rw2")))


res62.pred <- inla(formula62.pred, family = "nbinomial", data = new.speeds, E = Expected, control.compute = list(dic = T, waic=T, cpo=T, return.marginals.predictor=TRUE), control.predictor = list(compute = TRUE, link = 1),control.inla=list(strategy="laplace"))
summary(res62.pred)

plot(res62.pred$cpo$cpo)
sum(-log(na.omit(res62.pred$cpo$cpo)))
```


```{r}
RMSE(new.speeds$fallecidos.pred, res62.pred$summary.fitted.values$mean)
sqrt( mean( (new.speeds$fallecidos.pred - res62.pred$summary.fitted.values$mean)^2 , na.rm = TRUE ) )
```


```{r, error=TRUE}
# tab.ar1 <- data.frame(x = new.speeds$fallecidos.pred,
#   y = res62.pred$fallecidos.pred[, "mean"],
#   ll95 = res62.pred$fallecidos.pred$summary.fitted.values[, "0.025quant"],
#   ul95 = res62.pred$fallecidos.pred$summary.fitted.values[, "0.975quant"])
#res62$summary.random
new.speeds$RR.pred <- res62.pred$summary.fitted.values[, "mean"]
new.speeds$LL.pred <- res62.pred$summary.fitted.values[, "0.025quant"]
new.speeds$UL.pred <- res62.pred$summary.fitted.values[, "0.975quant"]
newdata.pred <- new.speeds[order(new.speeds$strdia.pred, new.speeds$numcanton.pred),]

```

```{r}
newdataRRabr.pred <- newdata.pred[985:1066,]
#newdataRRmay.pred <- newdata.pred[1067:1148,]

tm_shape(newdataRRabr.pred) +
tm_polygons(col = c("RR.pred", "LL.pred", "UL.pred"), style = 'fixed', border.col = "transparent",
breaks = c(0, 1, 5, 10, 50, 100)) +
tm_shape(newdataRRabr.pred) + tm_borders() +
tm_facets(ncol = 3) + tm_legend(legend.position = c("left", "bottom"), main.title= 'Abr 2021',  main.title.position = c('left', 'top'))


# tm_shape(newdataRRmay.pred) +
# tm_polygons(col = c("RR", "LL", "UL"), style = 'fixed', border.col = "transparent",
# breaks = c(0, 1, 5, 10, 50, 100)) +
# tm_shape(newdataRRmay.pred) + tm_borders() +
# tm_facets(ncol = 3) + tm_legend(legend.position = c("left", "bottom"), main.title= 'May 2021',  main.title.position = c('left', 'top'))

```


```{r}
predict1 <- res62.pred$summary.fitted.values %>% dplyr::select(mean,`0.025quant`,`0.975quant`, sd)
predict1
```


```{r}
summary(predict1)
```



```{r}
predict.rrisk <- res62.pred$summary.linear.predictor %>% dplyr::select(mean,`0.025quant`,`0.975quant`, sd)
predict.rrisk
```

```{r}
summary(predict.rrisk)
```
























```{r}
library(ggplot2)
marginal <- inla.smarginal(res62$marginals.fixed$SMR.anterior)
marginal <- data.frame(marginal)
ggplot(marginal, aes(x = x, y = y)) + geom_line() +
labs(x = expression(beta[1]), y = "Density") +
geom_vline(xintercept = 0, col = "black") + theme_bw()
```


```{r}
library(ggplot2)
marginal <- inla.smarginal(res62$marginals.fixed$`(Intercept)`)
marginal <- data.frame(marginal)
ggplot(marginal, aes(x = x, y = y)) + geom_line() +
labs(x = expression(beta[1]), y = "Density") +
geom_vline(xintercept = 0, col = "black") + theme_bw()
```



```{r, error=TRUE}

mapa_cantonestfg2$respa <- res62$summary.random$numcanton[mapa_cantonestfg2$numcanton, "mean"]

mapa_cantonestfg2$reiid <- res62$summary.random$numcanton2[, "mean"]
tm_shape(mapa_cantonestfg2) +
tm_polygons(col = c("respa", "reiid"), style = "cont", border.col = "transparent") +
tm_shape(mapa_cantonestfg2) + tm_borders() +
tm_facets(ncol = 2) + tm_legend(legend.position = c("left", "bottom"))
```








##MAYO
```{r}
new.speeds <- read.csv("datostfgpred2.csv", header = TRUE) 
head(new.speeds)
```


```{r}
new.speeds <- left_join(x = mapa_cantones,
                           y = new.speeds,
                           by = c("cant_nom2"="canton"))
head(new.speeds)
```


```{r}
# mapa_cantonestfg2.pred <- rbind(mapa_cantonestfg2, 
#   data.frame(fallecidos = rep(NA, 82), strdia=13))


numcanton2.pred <- new.speeds$numcanton.pred
strdia2.pred <- new.speeds$strdia.pred
formula62.pred <- (fallecidos.pred~SMR.anterior.pred+positivos.mes.anterior + positivos.2mes.anterior+fallecidos.anterior+
                             f(numcanton.pred, model="bym",graph=g) +
                             f(strdia.pred, model="rw2") +
                             f(strdiaint.pred, model="iid")+
                              f(numcanton2.pred, model="iid", group=strdia2.pred,
                               control.group=list(model="rw2")))


res62.pred <- inla(formula62.pred, family = "nbinomial", data = new.speeds, E = Expected, control.compute = list(dic = T, waic=T, cpo=T, return.marginals.predictor=TRUE), control.predictor = list(compute = TRUE, link = 1),control.inla=list(strategy="laplace"))
summary(res62.pred)

plot(res62.pred$cpo$cpo)
sum(-log(na.omit(res62.pred$cpo$cpo)))
```


```{r}
RMSE(new.speeds$fallecidos.pred, res62.pred$summary.fitted.values$mean)
sqrt( mean( (new.speeds$fallecidos.pred - res62.pred$summary.fitted.values$mean)^2 , na.rm = TRUE ) )
```


```{r}
# tab.ar1 <- data.frame(x = new.speeds$fallecidos.pred,
#   y = res62.pred$fallecidos.pred[, "mean"],
#   ll95 = res62.pred$fallecidos.pred$summary.fitted.values[, "0.025quant"],
#   ul95 = res62.pred$fallecidos.pred$summary.fitted.values[, "0.975quant"])
#res62$summary.random
new.speeds$RR.pred <- res62.pred$summary.fitted.values[, "mean"]
new.speeds$LL.pred <- res62.pred$summary.fitted.values[, "0.025quant"]
new.speeds$UL.pred <- res62.pred$summary.fitted.values[, "0.975quant"]
newdata.pred <- new.speeds[order(new.speeds$strdia.pred, new.speeds$numcanton.pred),]

```

```{r}
newdataRRmay.pred <- newdata.pred[1067:1148,]
#newdataRRmay.pred <- newdata.pred[1067:1148,]

tm_shape(newdataRRmay.pred) +
tm_polygons(col = c("RR.pred", "LL.pred", "UL.pred"), style = 'fixed', border.col = "transparent",
breaks = c(0, 1, 5, 10, 50, 100)) +
tm_shape(newdataRRmay.pred) + tm_borders() +
tm_facets(ncol = 3) + tm_legend(legend.position = c("left", "bottom"), main.title= 'Mayo 2021',  main.title.position = c('left', 'top'))


# tm_shape(newdataRRmay.pred) +
# tm_polygons(col = c("RR", "LL", "UL"), style = 'fixed', border.col = "transparent",
# breaks = c(0, 1, 5, 10, 50, 100)) +
# tm_shape(newdataRRmay.pred) + tm_borders() +
# tm_facets(ncol = 3) + tm_legend(legend.position = c("left", "bottom"), main.title= 'May 2021',  main.title.position = c('left', 'top'))

```


```{r}
predict1 <- res62.pred$summary.fitted.values %>% dplyr::select(mean,`0.025quant`,`0.975quant`, sd)
predict1
```


```{r}
summary(predict1)
```



```{r}
predict.rrisk <- res62.pred$summary.linear.predictor %>% dplyr::select(mean,`0.025quant`,`0.975quant`, sd)
predict.rrisk
```

```{r}
summary(predict.rrisk)
```



```{r}
library(ggplot2)
marginal <- inla.smarginal(res62.pred$marginals.fixed$SMR.anterior.pred)
marginal <- data.frame(marginal)
ggplot(marginal, aes(x = x, y = y)) + geom_line() +
labs(x = expression(beta[1]), y = "Density") +
geom_vline(xintercept = 0, col = "black") + theme_bw()
```


```{r}
library(ggplot2)
marginal <- inla.smarginal(res62.pred$marginals.fixed$`(Intercept)`)
marginal <- data.frame(marginal)
ggplot(marginal, aes(x = x, y = y)) + geom_line() +
labs(x = expression(beta[1]), y = "Density") +
geom_vline(xintercept = 0, col = "black") + theme_bw()
```
```{r}
library(ggplot2)
marginal <- inla.smarginal(res62.pred$marginals.fixed$positivos.mes.anterior)
marginal <- data.frame(marginal)
ggplot(marginal, aes(x = x, y = y)) + geom_line() +
labs(x = expression(beta[1]), y = "Density") +
geom_vline(xintercept = 0, col = "black") + theme_bw()
```
```{r}
library(ggplot2)
marginal <- inla.smarginal(res62.pred$marginals.fixed$positivos.2mes.anterior)
marginal <- data.frame(marginal)
ggplot(marginal, aes(x = x, y = y)) + geom_line() +
labs(x = expression(beta[1]), y = "Density") +
geom_vline(xintercept = 0, col = "black") + theme_bw()
```


```{r}
library(ggplot2)
marginal <- inla.smarginal(res62.pred$marginals.fixed$fallecidos.anterior)
marginal <- data.frame(marginal)
ggplot(marginal, aes(x = x, y = y)) + geom_line() +
labs(x = expression(beta[1]), y = "Density") +
geom_vline(xintercept = 0, col = "black") + theme_bw()
```

```{r}

newdata.pred$respa <- res62.pred$summary.random$numcanton.pred[newdata.pred$numcanton.pred, "mean"]

newdata.pred$reiid <- res62.pred$summary.random$numcanton2.pred[, "mean"]
tm_shape(newdata.pred) +
tm_polygons(col = c("respa", "reiid"), style = "cont", border.col = "transparent") +
tm_shape(newdata.pred) + tm_borders() +
tm_facets(ncol = 2) + tm_legend(legend.position = c("left", "bottom"))
```



```{r, error=TRUE}
summary(res62.pred)
exp(res62.pred$summary.fixed)
-mean(log(res62.pred$cpo$cpo))
#brier.score(mapa_cantonestfg2[["fallecidos"]], res62[["summary.fitted.values"]])
goftest::cvm.test(res62.pred$cpo$pit, null="punif")
```


```{r}
#exploring final model:
exp(res62.pred$summary.fixed)
summary(res62.pred)
```

```{r}
plot(res62.pred$marginals.fixed$SMR, main="SMR", xlab="", ylab="", xlim=c(-0.75,0.75), yaxt='n',
type="l")
abline(v=0, col="red")
plot(res62.pred$marginals.fixed$`(Intercept)`, main="Intercept", xlim=c(-0.1,0.1), xlab="", ylab="",
yaxt='n', type="l")
abline(v=0, col="red")

```






```{r}
yearsm <- res62.pred$summary.random$strdia.pred

plot(yearsm[, 1:2], type = 'l', 
     
      xlab = 'Month',
     
      ylab  = 'Smoother')

abline(h = 0 , lty = 3)

lines(yearsm[, c(1, 4)], lty = 2)

lines(yearsm[, c(1, 6)], lty = 2)

```







```{r}
new.speeds$RR <- res62.pred$summary.fitted.values[, "mean"]
new.speeds$LL <- res62.pred$summary.fitted.values[, "0.025quant"]
new.speeds$UL <- res62.pred$summary.fitted.values[, "0.975quant"]
newdata.pred <- new.speeds[order(new.speeds$strdia.pred, new.speeds$numcanton.pred),]


newdataRRabr.pred <- newdata.pred[1:82,]
newdataRRmay.pred <- newdata.pred[83:164,]
newdataRRjun.pred <- newdata.pred[165:246,]
newdataRRjul.pred <- newdata.pred[247:328,]
newdataRRago.pred <- newdata.pred[329:410,]
newdataRRset.pred <- newdata.pred[411:492,]
newdataRRoct.pred <- newdata.pred[493:574,]
newdataRRnov.pred <- newdata.pred[575:656,]
newdataRRdec.pred <- newdata.pred[657:738,]
newdataRRene.pred <- newdata.pred[739:820,]
newdataRRfeb.pred <- newdata.pred[821:902,]
newdataRRmar.pred <- newdata.pred[903:984,]
newdataRRabr2.pred <- newdata.pred[985:1066,]
newdataRRmay2.pred <- newdata.pred[1067:1148,]


par(mfrow=c(1,1))

tm_shape(newdataRRabr.pred) +
tm_polygons(col = c("RR", "LL", "UL"), style = 'fixed', border.col = "transparent",
breaks = c(0, 1, 5, 10, 50, 100)) +
tm_shape(newdataRRabr.pred) + tm_borders() +
tm_facets(ncol = 3) + tm_legend(legend.position = c("left", "bottom"), main.title= 'Abr 2020',  main.title.position = c('left', 'top'))


tm_shape(newdataRRmay.pred) +
tm_polygons(col = c("RR", "LL", "UL"), style = 'fixed', border.col = "transparent",
breaks = c(0, 1, 5, 10, 50, 100)) +
tm_shape(newdataRRmay.pred) + tm_borders() +
tm_facets(ncol = 3) + tm_legend(legend.position = c("left", "bottom"), main.title= 'May 2020',  main.title.position = c('left', 'top'))

tm_shape(newdataRRjun.pred) +
tm_polygons(col = c("RR", "LL", "UL"), style = 'fixed', border.col = "transparent",
breaks = c(0, 1, 5, 10, 50, 100)) +
tm_shape(newdataRRjun.pred) + tm_borders() +
tm_facets(ncol = 3) + tm_legend(legend.position = c("left", "bottom"), main.title= 'Jun 2020',  main.title.position = c('left', 'top'))

tm_shape(newdataRRjul.pred) +
tm_polygons(col = c("RR", "LL", "UL"), style = 'fixed', border.col = "transparent",
breaks = c(0, 1, 5, 10, 50, 100)) +
tm_shape(newdataRRjul.pred) + tm_borders() +
tm_facets(ncol = 3) + tm_legend(legend.position = c("left", "bottom"), main.title= 'Jul 2020',  main.title.position = c('left', 'top'))

tm_shape(newdataRRago.pred) +
tm_polygons(col = c("RR", "LL", "UL"), style = 'fixed', border.col = "transparent",
breaks = c(0, 1, 5, 10, 50, 100)) +
tm_shape(newdataRRago.pred) + tm_borders() +
tm_facets(ncol = 3) + tm_legend(legend.position = c("left", "bottom"), main.title= 'Ago 2020',  main.title.position = c('left', 'top'))

tm_shape(newdataRRset.pred) +
tm_polygons(col = c("RR", "LL", "UL"), style = 'fixed', border.col = "transparent",
breaks = c(0, 1, 5, 10, 50, 100)) +
tm_shape(newdataRRset.pred) + tm_borders() +
tm_facets(ncol = 3) + tm_legend(legend.position = c("left", "bottom"), main.title= 'Set 2020',  main.title.position = c('left', 'top'))

tm_shape(newdataRRoct.pred) +
tm_polygons(col = c("RR", "LL", "UL"), style = 'fixed', border.col = "transparent",
breaks = c(0, 1, 5, 10, 50, 100)) +
tm_shape(newdataRRoct.pred) + tm_borders() +
tm_facets(ncol = 3) + tm_legend(legend.position = c("left", "bottom"), main.title= 'Oct 2020',  main.title.position = c('left', 'top'))

tm_shape(newdataRRnov.pred) +
tm_polygons(col = c("RR", "LL", "UL"), style = 'fixed', border.col = "transparent",
breaks = c(0, 1, 5, 10, 50, 100)) +
tm_shape(newdataRRnov.pred) + tm_borders() +
tm_facets(ncol = 3) + tm_legend(legend.position = c("left", "bottom"), main.title= 'Nov 2020',  main.title.position = c('left', 'top'))

tm_shape(newdataRRdec.pred) +
tm_polygons(col = c("RR", "LL", "UL"), style = 'fixed', border.col = "transparent",
breaks = c(0, 1, 5, 10, 50, 100)) +
tm_shape(newdataRRdec.pred) + tm_borders() +
tm_facets(ncol = 3) + tm_legend(legend.position = c("left", "bottom"), main.title= 'Dec 2020',  main.title.position = c('left', 'top'))

tm_shape(newdataRRene.pred) +
tm_polygons(col = c("RR", "LL", "UL"), style = 'fixed', border.col = "transparent",
breaks = c(0, 1, 5, 10, 50, 100)) +
tm_shape(newdataRRene.pred) + tm_borders() +
tm_facets(ncol = 3) + tm_legend(legend.position = c("left", "bottom"), main.title= 'Ene 2021',  main.title.position = c('left', 'top'))

tm_shape(newdataRRfeb.pred) +
tm_polygons(col = c("RR", "LL", "UL"), style = 'fixed', border.col = "transparent",
breaks = c(0, 1, 5, 10, 50, 100)) +
tm_shape(newdataRRfeb.pred) + tm_borders() +
tm_facets(ncol = 3) + tm_legend(legend.position = c("left", "bottom"), main.title= 'Feb 2021',  main.title.position = c('left', 'top'))

tm_shape(newdataRRmar.pred) +
tm_polygons(col = c("RR", "LL", "UL"), style = 'fixed', border.col = "transparent",
breaks = c(0, 1, 5, 10, 50, 100)) +
tm_shape(newdataRRmar.pred) + tm_borders() +
tm_facets(ncol = 3) + tm_legend(legend.position = c("left", "bottom"), main.title= 'Mar 2021',  main.title.position = c('left', 'top'))

tm_shape(newdataRRabr2.pred) +
tm_polygons(col = c("RR", "LL", "UL"), style = 'fixed', border.col = "transparent",
breaks = c(0, 1, 5, 10, 50, 100)) +
tm_shape(newdataRRabr2.pred) + tm_borders() +
tm_facets(ncol = 3) + tm_legend(legend.position = c("left", "bottom"), main.title= 'Abr 2021',  main.title.position = c('left', 'top'))

tm_shape(newdataRRmay2.pred) +
tm_polygons(col = c("RR", "LL", "UL"), style = 'fixed', border.col = "transparent",
breaks = c(0, 1, 5, 10, 50, 100)) +
tm_shape(newdataRRmay2.pred) + tm_borders() +
tm_facets(ncol = 3) + tm_legend(legend.position = c("left", "bottom"), main.title= 'May 2021',  main.title.position = c('left', 'top'))
```

```{r}
newdata.pred27 <- new.speeds[order(new.speeds$numcanton.pred, new.speeds$strdia.pred),]

newdata.pred21 <- newdata.pred27[1:14,]
```

```{r}
tab.ar1 <- data.frame(x = newdata.pred21$strdia.pred,
  y = newdata.pred21$RR.pred,
  ll95 = newdata.pred21$LL.pred,
  ul95 = newdata.pred21$UL.pred)

tab.labels <- data.frame(
  x = c(1, 14),
  y = c(10, 10),
  text = c("observed", "predicted")
)

ggplot(newdata.pred21, aes(x = strdia.pred, y = fallecidos.pred)) +

  xlab("Mes") +
  ylab("Prediccion fallecidos canton de Abangares, Guanacaste")+

  geom_ribbon(aes(x = x, y = y, ymin = ll95, ymax = ul95), fill="chocolate1", alpha = 0.75, data = tab.ar1) +
  geom_ribbon(aes(x = x, y = y, ymin = ll95, ymax = ul95), fill="chocolate1", alpha = 0.5, data = tab.ar1[-(1:nrow(newdata.pred21)), ]) +

    geom_line(aes(x = x, y = y), linetype = 1, col = "blue", data = tab.ar1, size=1) +
      geom_point(shape = 20, alpha = 2, size=3) +

  geom_vline(xintercept = 12, linetype = "dashed", colour = "red") +
  geom_text(data = tab.labels, aes(x = x, y = y, label = text))
```

```{r}
newdata.pred22 <- newdata.pred27[15:28,]
```

```{r}
tab.ar1 <- data.frame(x = newdata.pred22$strdia.pred,
  y = newdata.pred22$RR.pred,
  ll95 = newdata.pred22$LL.pred,
  ul95 = newdata.pred22$UL.pred)

tab.labels <- data.frame(
  x = c(1, 14),
  y = c(10, 10),
  text = c("observed", "predicted")
)

ggplot(newdata.pred22, aes(x = strdia.pred, y = fallecidos.pred)) +
  xlab("Mes") +
  ylab("Prediccion fallecidos canton de Acosta, San Jose")+

  geom_ribbon(aes(x = x, y = y, ymin = ll95, ymax = ul95), fill="chocolate1", alpha = 0.75, data = tab.ar1) +
  geom_ribbon(aes(x = x, y = y, ymin = ll95, ymax = ul95), fill="chocolate1", alpha = 0.5, data = tab.ar1[-(1:nrow(newdata.pred21)), ]) +

    geom_line(aes(x = x, y = y), linetype = 1, col = "blue", data = tab.ar1, size=1) +
      geom_point(shape = 20, alpha = 2, size=3) +

  geom_vline(xintercept = 12, linetype = "dashed", colour = "red") +
  geom_text(data = tab.labels, aes(x = x, y = y, label = text))
```

```{r}
newdata.pred23 <- newdata.pred27[29:42,]
```

```{r}
tab.ar1 <- data.frame(x = newdata.pred23$strdia.pred,
  y = newdata.pred23$RR.pred,
  ll95 = newdata.pred23$LL.pred,
  ul95 = newdata.pred23$UL.pred)

tab.labels <- data.frame(
  x = c(1, 14),
  y = c(10, 10),
  text = c("observed", "predicted")
)

ggplot(newdata.pred23, aes(x = strdia.pred, y = fallecidos.pred)) +
  xlab("Mes") +
  ylab("Prediccion fallecidos canton de Alajuela, Alajuela")+

  geom_ribbon(aes(x = x, y = y, ymin = ll95, ymax = ul95), fill="chocolate1", alpha = 0.75, data = tab.ar1) +
  geom_ribbon(aes(x = x, y = y, ymin = ll95, ymax = ul95), fill="chocolate1", alpha = 0.5, data = tab.ar1[-(1:nrow(newdata.pred21)), ]) +

    geom_line(aes(x = x, y = y), linetype = 1, col = "blue", data = tab.ar1, size=1) +
      geom_point(shape = 20, alpha = 2, size=3) +

  geom_vline(xintercept = 12, linetype = "dashed", colour = "red") +
  geom_text(data = tab.labels, aes(x = x, y = y, label = text))
```

```{r}
newdata.pred24 <- newdata.pred27[43:56,]
```

```{r}
tab.ar1 <- data.frame(x = newdata.pred24$strdia.pred,
  y = newdata.pred24$RR.pred,
  ll95 = newdata.pred24$LL.pred,
  ul95 = newdata.pred24$UL.pred)

tab.labels <- data.frame(
  x = c(1, 14),
  y = c(10, 10),
  text = c("observed", "predicted")
)

ggplot(newdata.pred24, aes(x = strdia.pred, y = fallecidos.pred)) +
  xlab("Mes") +
  ylab("Prediccion fallecidos canton de Alajuelita, San Jose")+

  geom_ribbon(aes(x = x, y = y, ymin = ll95, ymax = ul95), fill="chocolate1", alpha = 0.75, data = tab.ar1) +
  geom_ribbon(aes(x = x, y = y, ymin = ll95, ymax = ul95), fill="chocolate1", alpha = 0.5, data = tab.ar1[-(1:nrow(newdata.pred21)), ]) +

    geom_line(aes(x = x, y = y), linetype = 1, col = "blue", data = tab.ar1, size=1) +
      geom_point(shape = 20, alpha = 2, size=3) +

  geom_vline(xintercept = 12, linetype = "dashed", colour = "red") +
  geom_text(data = tab.labels, aes(x = x, y = y, label = text))
```

```{r}
newdata.pred25 <- newdata.pred27[57:70,]
```

```{r}
tab.ar1 <- data.frame(x = newdata.pred25$strdia.pred,
  y = newdata.pred25$RR.pred,
  ll95 = newdata.pred25$LL.pred,
  ul95 = newdata.pred25$UL.pred)

tab.labels <- data.frame(
  x = c(1, 14),
  y = c(10, 10),
  text = c("observed", "predicted")
)

ggplot(newdata.pred25, aes(x = strdia.pred, y = fallecidos.pred)) +
  xlab("Mes") +
  ylab("Prediccion fallecidos canton de Alvarado, Cartago")+

  geom_ribbon(aes(x = x, y = y, ymin = ll95, ymax = ul95), fill="chocolate1", alpha = 0.75, data = tab.ar1) +
  geom_ribbon(aes(x = x, y = y, ymin = ll95, ymax = ul95), fill="chocolate1", alpha = 0.5, data = tab.ar1[-(1:nrow(newdata.pred21)), ]) +

    geom_line(aes(x = x, y = y), linetype = 1, col = "blue", data = tab.ar1, size=1) +
      geom_point(shape = 20, alpha = 2, size=3) +

  geom_vline(xintercept = 12, linetype = "dashed", colour = "red") +
  geom_text(data = tab.labels, aes(x = x, y = y, label = text))
```

```{r}
newdata.pred25 <- newdata.pred27[71:84,]
```

```{r}
tab.ar1 <- data.frame(x = newdata.pred25$strdia.pred,
  y = newdata.pred25$RR.pred,
  ll95 = newdata.pred25$LL.pred,
  ul95 = newdata.pred25$UL.pred)

tab.labels <- data.frame(
  x = c(1, 14),
  y = c(10, 10),
  text = c("observed", "predicted")
)

ggplot(newdata.pred25, aes(x = strdia.pred, y = fallecidos.pred)) +
  xlab("Mes") +
  ylab("Prediccion fallecidos canton de Aserri, San Jose")+

  geom_ribbon(aes(x = x, y = y, ymin = ll95, ymax = ul95), fill="chocolate1", alpha = 0.75, data = tab.ar1) +
  geom_ribbon(aes(x = x, y = y, ymin = ll95, ymax = ul95), fill="chocolate1", alpha = 0.5, data = tab.ar1[-(1:nrow(newdata.pred21)), ]) +

    geom_line(aes(x = x, y = y), linetype = 1, col = "blue", data = tab.ar1, size=1) +
      geom_point(shape = 20, alpha = 2, size=3) +

  geom_vline(xintercept = 12, linetype = "dashed", colour = "red") +
  geom_text(data = tab.labels, aes(x = x, y = y, label = text))
```

```{r}
newdata.pred25 <- newdata.pred27[85:98,]
```

```{r}
tab.ar1 <- data.frame(x = newdata.pred25$strdia.pred,
  y = newdata.pred25$RR.pred,
  ll95 = newdata.pred25$LL.pred,
  ul95 = newdata.pred25$UL.pred)

tab.labels <- data.frame(
  x = c(1, 14),
  y = c(10, 10),
  text = c("observed", "predicted")
)

ggplot(newdata.pred25, aes(x = strdia.pred, y = fallecidos.pred)) +
  xlab("Mes") +
  ylab("Prediccion fallecidos canton de Atenas, Alajuela")+

  geom_ribbon(aes(x = x, y = y, ymin = ll95, ymax = ul95), fill="chocolate1", alpha = 0.75, data = tab.ar1) +
  geom_ribbon(aes(x = x, y = y, ymin = ll95, ymax = ul95), fill="chocolate1", alpha = 0.5, data = tab.ar1[-(1:nrow(newdata.pred21)), ]) +

    geom_line(aes(x = x, y = y), linetype = 1, col = "blue", data = tab.ar1, size=1) +
      geom_point(shape = 20, alpha = 2, size=3) +

  geom_vline(xintercept = 12, linetype = "dashed", colour = "red") +
  geom_text(data = tab.labels, aes(x = x, y = y, label = text))
```

```{r}
newdata.pred25 <- newdata.pred27[99:112,]
```

```{r}
tab.ar1 <- data.frame(x = newdata.pred25$strdia.pred,
  y = newdata.pred25$RR.pred,
  ll95 = newdata.pred25$LL.pred,
  ul95 = newdata.pred25$UL.pred)

tab.labels <- data.frame(
  x = c(1, 14),
  y = c(10, 10),
  text = c("observed", "predicted")
)

ggplot(newdata.pred25, aes(x = strdia.pred, y = fallecidos.pred)) +
  xlab("Mes") +
  ylab("Prediccion fallecidos canton de Bagaces, Guanacaste")+
  geom_ribbon(aes(x = x, y = y, ymin = ll95, ymax = ul95), fill="chocolate1", alpha = 0.75, data = tab.ar1) +
  geom_ribbon(aes(x = x, y = y, ymin = ll95, ymax = ul95), fill="chocolate1", alpha = 0.5, data = tab.ar1[-(1:nrow(newdata.pred21)), ]) +

    geom_line(aes(x = x, y = y), linetype = 1, col = "blue", data = tab.ar1, size=1) +
      geom_point(shape = 20, alpha = 2, size=3) +

  geom_vline(xintercept = 12, linetype = "dashed", colour = "red") +
  geom_text(data = tab.labels, aes(x = x, y = y, label = text))
```

```{r}
newdata.pred25 <- newdata.pred27[113:126,]
```

```{r}
tab.ar1 <- data.frame(x = newdata.pred25$strdia.pred,
  y = newdata.pred25$RR.pred,
  ll95 = newdata.pred25$LL.pred,
  ul95 = newdata.pred25$UL.pred)

tab.labels <- data.frame(
  x = c(1, 14),
  y = c(10, 10),
  text = c("observed", "predicted")
)

ggplot(newdata.pred25, aes(x = strdia.pred, y = fallecidos.pred)) +
  xlab("Mes") +
  ylab("Prediccion fallecidos canton de Barva, Heredia")+

  geom_ribbon(aes(x = x, y = y, ymin = ll95, ymax = ul95), fill="chocolate1", alpha = 0.75, data = tab.ar1) +
  geom_ribbon(aes(x = x, y = y, ymin = ll95, ymax = ul95), fill="chocolate1", alpha = 0.5, data = tab.ar1[-(1:nrow(newdata.pred21)), ]) +

    geom_line(aes(x = x, y = y), linetype = 1, col = "blue", data = tab.ar1, size=1) +
      geom_point(shape = 20, alpha = 2, size=3) +

  geom_vline(xintercept = 12, linetype = "dashed", colour = "red") +
  geom_text(data = tab.labels, aes(x = x, y = y, label = text))
```
```{r}
newdata.pred25 <- newdata.pred27[127:140,]
```

```{r}
tab.ar1 <- data.frame(x = newdata.pred25$strdia.pred,
  y = newdata.pred25$RR.pred,
  ll95 = newdata.pred25$LL.pred,
  ul95 = newdata.pred25$UL.pred)

tab.labels <- data.frame(
  x = c(1, 14),
  y = c(10, 10),
  text = c("observed", "predicted")
)

ggplot(newdata.pred25, aes(x = strdia.pred, y = fallecidos.pred)) +
  xlab("Mes") +
  ylab("Prediccion fallecidos canton de Belen, Heredia")+

  geom_ribbon(aes(x = x, y = y, ymin = ll95, ymax = ul95), fill="chocolate1", alpha = 0.75, data = tab.ar1) +
  geom_ribbon(aes(x = x, y = y, ymin = ll95, ymax = ul95), fill="chocolate1", alpha = 0.5, data = tab.ar1[-(1:nrow(newdata.pred21)), ]) +

    geom_line(aes(x = x, y = y), linetype = 1, col = "blue", data = tab.ar1, size=1) +
      geom_point(shape = 20, alpha = 2, size=3) +

  geom_vline(xintercept = 12, linetype = "dashed", colour = "red") +
  geom_text(data = tab.labels, aes(x = x, y = y, label = text))
```

```{r}
newdata.pred25 <- newdata.pred27[141:154,]
```

```{r}
tab.ar1 <- data.frame(x = newdata.pred25$strdia.pred,
  y = newdata.pred25$RR.pred,
  ll95 = newdata.pred25$LL.pred,
  ul95 = newdata.pred25$UL.pred)

tab.labels <- data.frame(
  x = c(1, 14),
  y = c(10, 10),
  text = c("observed", "predicted")
)

ggplot(newdata.pred25, aes(x = strdia.pred, y = fallecidos.pred)) +
  xlab("Mes") +
  ylab("Prediccion fallecidos canton de Buenos Aires, Puntarenas")+

  geom_ribbon(aes(x = x, y = y, ymin = ll95, ymax = ul95), fill="chocolate1", alpha = 0.75, data = tab.ar1) +
  geom_ribbon(aes(x = x, y = y, ymin = ll95, ymax = ul95), fill="chocolate1", alpha = 0.5, data = tab.ar1[-(1:nrow(newdata.pred21)), ]) +

    geom_line(aes(x = x, y = y), linetype = 1, col = "blue", data = tab.ar1, size=1) +
      geom_point(shape = 20, alpha = 2, size=3) +

  geom_vline(xintercept = 12, linetype = "dashed", colour = "red") +
  geom_text(data = tab.labels, aes(x = x, y = y, label = text))
```

```{r}
newdata.pred25 <- newdata.pred27[155:168,]
```

```{r}
tab.ar1 <- data.frame(x = newdata.pred25$strdia.pred,
  y = newdata.pred25$RR.pred,
  ll95 = newdata.pred25$LL.pred,
  ul95 = newdata.pred25$UL.pred)

tab.labels <- data.frame(
  x = c(1, 14),
  y = c(10, 10),
  text = c("observed", "predicted")
)

ggplot(newdata.pred25, aes(x = strdia.pred, y = fallecidos.pred)) +
  xlab("Mes") +
  ylab("Prediccion fallecidos canton de Canas, Guanacaste")+

  geom_ribbon(aes(x = x, y = y, ymin = ll95, ymax = ul95), fill="chocolate1", alpha = 0.75, data = tab.ar1) +
  geom_ribbon(aes(x = x, y = y, ymin = ll95, ymax = ul95), fill="chocolate1", alpha = 0.5, data = tab.ar1[-(1:nrow(newdata.pred21)), ]) +

    geom_line(aes(x = x, y = y), linetype = 1, col = "blue", data = tab.ar1, size=1) +
      geom_point(shape = 20, alpha = 2, size=3) +

  geom_vline(xintercept = 12, linetype = "dashed", colour = "red") +
  geom_text(data = tab.labels, aes(x = x, y = y, label = text))
```

```{r}
newdata.pred25 <- newdata.pred27[169:182,]
```

```{r}
tab.ar1 <- data.frame(x = newdata.pred25$strdia.pred,
  y = newdata.pred25$RR.pred,
  ll95 = newdata.pred25$LL.pred,
  ul95 = newdata.pred25$UL.pred)

tab.labels <- data.frame(
  x = c(1, 14),
  y = c(10, 10),
  text = c("observed", "predicted")
)

ggplot(newdata.pred25, aes(x = strdia.pred, y = fallecidos.pred)) +
  xlab("Mes") +
  ylab("Prediccion fallecidos canton de Carrillo, Guanacaste")+

  geom_ribbon(aes(x = x, y = y, ymin = ll95, ymax = ul95), fill="chocolate1", alpha = 0.75, data = tab.ar1) +
  geom_ribbon(aes(x = x, y = y, ymin = ll95, ymax = ul95), fill="chocolate1", alpha = 0.5, data = tab.ar1[-(1:nrow(newdata.pred21)), ]) +

    geom_line(aes(x = x, y = y), linetype = 1, col = "blue", data = tab.ar1, size=1) +
      geom_point(shape = 20, alpha = 2, size=3) +

  geom_vline(xintercept = 12, linetype = "dashed", colour = "red") +
  geom_text(data = tab.labels, aes(x = x, y = y, label = text))
```

```{r}
newdata.pred25 <- newdata.pred27[183:196,]
```

```{r}
tab.ar1 <- data.frame(x = newdata.pred25$strdia.pred,
  y = newdata.pred25$RR.pred,
  ll95 = newdata.pred25$LL.pred,
  ul95 = newdata.pred25$UL.pred)

tab.labels <- data.frame(
  x = c(1, 14),
  y = c(10, 10),
  text = c("observed", "predicted")
)

ggplot(newdata.pred25, aes(x = strdia.pred, y = fallecidos.pred)) +
  xlab("Mes") +
  ylab("Prediccion fallecidos canton de Cartago, Cartago")+

  geom_ribbon(aes(x = x, y = y, ymin = ll95, ymax = ul95), fill="chocolate1", alpha = 0.75, data = tab.ar1) +
  geom_ribbon(aes(x = x, y = y, ymin = ll95, ymax = ul95), fill="chocolate1", alpha = 0.5, data = tab.ar1[-(1:nrow(newdata.pred21)), ]) +

    geom_line(aes(x = x, y = y), linetype = 1, col = "blue", data = tab.ar1, size=1) +
      geom_point(shape = 20, alpha = 2, size=3) +

  geom_vline(xintercept = 12, linetype = "dashed", colour = "red") +
  geom_text(data = tab.labels, aes(x = x, y = y, label = text))
```

```{r}
newdata.pred25 <- newdata.pred27[197:210,]
```

```{r}
tab.ar1 <- data.frame(x = newdata.pred25$strdia.pred,
  y = newdata.pred25$RR.pred,
  ll95 = newdata.pred25$LL.pred,
  ul95 = newdata.pred25$UL.pred)

tab.labels <- data.frame(
  x = c(1, 14),
  y = c(10, 10),
  text = c("observed", "predicted")
)

ggplot(newdata.pred25, aes(x = strdia.pred, y = fallecidos.pred)) +
  xlab("Mes") +
  ylab("Prediccion fallecidos canton de Corredores, Puntarenas")+

  geom_ribbon(aes(x = x, y = y, ymin = ll95, ymax = ul95), fill="chocolate1", alpha = 0.75, data = tab.ar1) +
  geom_ribbon(aes(x = x, y = y, ymin = ll95, ymax = ul95), fill="chocolate1", alpha = 0.5, data = tab.ar1[-(1:nrow(newdata.pred21)), ]) +

    geom_line(aes(x = x, y = y), linetype = 1, col = "blue", data = tab.ar1, size=1) +
      geom_point(shape = 20, alpha = 2, size=3) +

  geom_vline(xintercept = 12, linetype = "dashed", colour = "red") +
  geom_text(data = tab.labels, aes(x = x, y = y, label = text))
```

```{r}
newdata.pred25 <- newdata.pred27[211:224,]
```

```{r}
tab.ar1 <- data.frame(x = newdata.pred25$strdia.pred,
  y = newdata.pred25$RR.pred,
  ll95 = newdata.pred25$LL.pred,
  ul95 = newdata.pred25$UL.pred)

tab.labels <- data.frame(
  x = c(1, 14),
  y = c(10, 10),
  text = c("observed", "predicted")
)

ggplot(newdata.pred25, aes(x = strdia.pred, y = fallecidos.pred)) +
  xlab("Mes") +
  ylab("Prediccion fallecidos canton de Coto Brus, Puntarenas")+

  geom_ribbon(aes(x = x, y = y, ymin = ll95, ymax = ul95), fill="chocolate1", alpha = 0.75, data = tab.ar1) +
  geom_ribbon(aes(x = x, y = y, ymin = ll95, ymax = ul95), fill="chocolate1", alpha = 0.5, data = tab.ar1[-(1:nrow(newdata.pred21)), ]) +

    geom_line(aes(x = x, y = y), linetype = 1, col = "blue", data = tab.ar1, size=1) +
      geom_point(shape = 20, alpha = 2, size=3) +

  geom_vline(xintercept = 12, linetype = "dashed", colour = "red") +
  geom_text(data = tab.labels, aes(x = x, y = y, label = text))
```

```{r}
newdata.pred25 <- newdata.pred27[225:238,]
```

```{r}
tab.ar1 <- data.frame(x = newdata.pred25$strdia.pred,
  y = newdata.pred25$RR.pred,
  ll95 = newdata.pred25$LL.pred,
  ul95 = newdata.pred25$UL.pred)

tab.labels <- data.frame(
  x = c(1, 14),
  y = c(10, 10),
  text = c("observed", "predicted")
)

ggplot(newdata.pred25, aes(x = strdia.pred, y = fallecidos.pred)) +
  xlab("Mes") +
  ylab("Prediccion fallecidos canton de Curridabat, San Jose")+

  geom_ribbon(aes(x = x, y = y, ymin = ll95, ymax = ul95), fill="chocolate1", alpha = 0.75, data = tab.ar1) +
  geom_ribbon(aes(x = x, y = y, ymin = ll95, ymax = ul95), fill="chocolate1", alpha = 0.5, data = tab.ar1[-(1:nrow(newdata.pred21)), ]) +

    geom_line(aes(x = x, y = y), linetype = 1, col = "blue", data = tab.ar1, size=1) +
      geom_point(shape = 20, alpha = 2, size=3) +

  geom_vline(xintercept = 12, linetype = "dashed", colour = "red") +
  geom_text(data = tab.labels, aes(x = x, y = y, label = text))
```


```{r}
newdata.pred25 <- newdata.pred27[239:252,]
```

```{r}
tab.ar1 <- data.frame(x = newdata.pred25$strdia.pred,
  y = newdata.pred25$RR.pred,
  ll95 = newdata.pred25$LL.pred,
  ul95 = newdata.pred25$UL.pred)

tab.labels <- data.frame(
  x = c(1, 14),
  y = c(10, 10),
  text = c("observed", "predicted")
)

ggplot(newdata.pred25, aes(x = strdia.pred, y = fallecidos.pred)) +
  xlab("Mes") +
  ylab("Prediccion fallecidos canton de Desamparados, San Jose")+

  geom_ribbon(aes(x = x, y = y, ymin = ll95, ymax = ul95), fill="chocolate1", alpha = 0.75, data = tab.ar1) +
  geom_ribbon(aes(x = x, y = y, ymin = ll95, ymax = ul95), fill="chocolate1", alpha = 0.5, data = tab.ar1[-(1:nrow(newdata.pred21)), ]) +

    geom_line(aes(x = x, y = y), linetype = 1, col = "blue", data = tab.ar1, size=1) +
      geom_point(shape = 20, alpha = 2, size=3) +

  geom_vline(xintercept = 12, linetype = "dashed", colour = "red") +
  geom_text(data = tab.labels, aes(x = x, y = y, label = text))
```

```{r}
newdata.pred25 <- newdata.pred27[253:266,]
```

```{r}
tab.ar1 <- data.frame(x = newdata.pred25$strdia.pred,
  y = newdata.pred25$RR.pred,
  ll95 = newdata.pred25$LL.pred,
  ul95 = newdata.pred25$UL.pred)

tab.labels <- data.frame(
  x = c(1, 14),
  y = c(10, 10),
  text = c("observed", "predicted")
)

ggplot(newdata.pred25, aes(x = strdia.pred, y = fallecidos.pred)) +
  xlab("Mes") +
  ylab("Prediccion fallecidos canton de Dota, San Jose")+

  geom_ribbon(aes(x = x, y = y, ymin = ll95, ymax = ul95), fill="chocolate1", alpha = 0.75, data = tab.ar1) +
  geom_ribbon(aes(x = x, y = y, ymin = ll95, ymax = ul95), fill="chocolate1", alpha = 0.5, data = tab.ar1[-(1:nrow(newdata.pred21)), ]) +

    geom_line(aes(x = x, y = y), linetype = 1, col = "blue", data = tab.ar1, size=1) +
      geom_point(shape = 20, alpha = 2, size=3) +

  geom_vline(xintercept = 12, linetype = "dashed", colour = "red") +
  geom_text(data = tab.labels, aes(x = x, y = y, label = text))
```


```{r}
newdata.pred25 <- newdata.pred27[267:280,]
```

```{r}
tab.ar1 <- data.frame(x = newdata.pred25$strdia.pred,
  y = newdata.pred25$RR.pred,
  ll95 = newdata.pred25$LL.pred,
  ul95 = newdata.pred25$UL.pred)

tab.labels <- data.frame(
  x = c(1, 14),
  y = c(10, 10),
  text = c("observed", "predicted")
)

ggplot(newdata.pred25, aes(x = strdia.pred, y = fallecidos.pred)) +
  xlab("Mes") +
  ylab("Prediccion fallecidos canton de El Guarco, Cartago")+

  geom_ribbon(aes(x = x, y = y, ymin = ll95, ymax = ul95), fill="chocolate1", alpha = 0.75, data = tab.ar1) +
  geom_ribbon(aes(x = x, y = y, ymin = ll95, ymax = ul95), fill="chocolate1", alpha = 0.5, data = tab.ar1[-(1:nrow(newdata.pred21)), ]) +

    geom_line(aes(x = x, y = y), linetype = 1, col = "blue", data = tab.ar1, size=1) +
      geom_point(shape = 20, alpha = 2, size=3) +

  geom_vline(xintercept = 12, linetype = "dashed", colour = "red") +
  geom_text(data = tab.labels, aes(x = x, y = y, label = text))
```

```{r}
newdata.pred25 <- newdata.pred27[281:294,]
```

```{r}
tab.ar1 <- data.frame(x = newdata.pred25$strdia.pred,
  y = newdata.pred25$RR.pred,
  ll95 = newdata.pred25$LL.pred,
  ul95 = newdata.pred25$UL.pred)

tab.labels <- data.frame(
  x = c(1, 14),
  y = c(10, 10),
  text = c("observed", "predicted")
)

ggplot(newdata.pred25, aes(x = strdia.pred, y = fallecidos.pred)) +
  xlab("Mes") +
  ylab("Prediccion fallecidos canton de Escazu, San Jose")+

  geom_ribbon(aes(x = x, y = y, ymin = ll95, ymax = ul95), fill="chocolate1", alpha = 0.75, data = tab.ar1) +
  geom_ribbon(aes(x = x, y = y, ymin = ll95, ymax = ul95), fill="chocolate1", alpha = 0.5, data = tab.ar1[-(1:nrow(newdata.pred21)), ]) +

    geom_line(aes(x = x, y = y), linetype = 1, col = "blue", data = tab.ar1, size=1) +
      geom_point(shape = 20, alpha = 2, size=3) +

  geom_vline(xintercept = 12, linetype = "dashed", colour = "red") +
  geom_text(data = tab.labels, aes(x = x, y = y, label = text))
```

```{r}
newdata.pred25 <- newdata.pred27[295:308,]
```

```{r}
tab.ar1 <- data.frame(x = newdata.pred25$strdia.pred,
  y = newdata.pred25$RR.pred,
  ll95 = newdata.pred25$LL.pred,
  ul95 = newdata.pred25$UL.pred)

tab.labels <- data.frame(
  x = c(1, 14),
  y = c(10, 10),
  text = c("observed", "predicted")
)

ggplot(newdata.pred25, aes(x = strdia.pred, y = fallecidos.pred)) +
  xlab("Mes") +
  ylab("Prediccion fallecidos canton de Esparza, Puntarenas")+

  geom_ribbon(aes(x = x, y = y, ymin = ll95, ymax = ul95), fill="chocolate1", alpha = 0.75, data = tab.ar1) +
  geom_ribbon(aes(x = x, y = y, ymin = ll95, ymax = ul95), fill="chocolate1", alpha = 0.5, data = tab.ar1[-(1:nrow(newdata.pred21)), ]) +

    geom_line(aes(x = x, y = y), linetype = 1, col = "blue", data = tab.ar1, size=1) +
      geom_point(shape = 20, alpha = 2, size=3) +

  geom_vline(xintercept = 12, linetype = "dashed", colour = "red") +
  geom_text(data = tab.labels, aes(x = x, y = y, label = text))
```

```{r}
newdata.pred25 <- newdata.pred27[309:322,]
```

```{r}
tab.ar1 <- data.frame(x = newdata.pred25$strdia.pred,
  y = newdata.pred25$RR.pred,
  ll95 = newdata.pred25$LL.pred,
  ul95 = newdata.pred25$UL.pred)

tab.labels <- data.frame(
  x = c(1, 14),
  y = c(10, 10),
  text = c("observed", "predicted")
)

ggplot(newdata.pred25, aes(x = strdia.pred, y = fallecidos.pred)) +
  xlab("Mes") +
  ylab("Prediccion fallecidos canton de Flores, Heredia")+

  geom_ribbon(aes(x = x, y = y, ymin = ll95, ymax = ul95), fill="chocolate1", alpha = 0.75, data = tab.ar1) +
  geom_ribbon(aes(x = x, y = y, ymin = ll95, ymax = ul95), fill="chocolate1", alpha = 0.5, data = tab.ar1[-(1:nrow(newdata.pred21)), ]) +

    geom_line(aes(x = x, y = y), linetype = 1, col = "blue", data = tab.ar1, size=1) +
      geom_point(shape = 20, alpha = 2, size=3) +

  geom_vline(xintercept = 12, linetype = "dashed", colour = "red") +
  geom_text(data = tab.labels, aes(x = x, y = y, label = text))
```

```{r}
newdata.pred25 <- newdata.pred27[323:336,]
```

```{r}
tab.ar1 <- data.frame(x = newdata.pred25$strdia.pred,
  y = newdata.pred25$RR.pred,
  ll95 = newdata.pred25$LL.pred,
  ul95 = newdata.pred25$UL.pred)

tab.labels <- data.frame(
  x = c(1, 14),
  y = c(10, 10),
  text = c("observed", "predicted")
)

ggplot(newdata.pred25, aes(x = strdia.pred, y = fallecidos.pred)) +
  xlab("Mes") +
  ylab("Prediccion fallecidos canton de Garabito, Puntarenas")+

  geom_ribbon(aes(x = x, y = y, ymin = ll95, ymax = ul95), fill="chocolate1", alpha = 0.75, data = tab.ar1) +
  geom_ribbon(aes(x = x, y = y, ymin = ll95, ymax = ul95), fill="chocolate1", alpha = 0.5, data = tab.ar1[-(1:nrow(newdata.pred21)), ]) +

    geom_line(aes(x = x, y = y), linetype = 1, col = "blue", data = tab.ar1, size=1) +
      geom_point(shape = 20, alpha = 2, size=3) +

  geom_vline(xintercept = 12, linetype = "dashed", colour = "red") +
  geom_text(data = tab.labels, aes(x = x, y = y, label = text))
```

```{r}
newdata.pred25 <- newdata.pred27[337:350,]
```

```{r}
tab.ar1 <- data.frame(x = newdata.pred25$strdia.pred,
  y = newdata.pred25$RR.pred,
  ll95 = newdata.pred25$LL.pred,
  ul95 = newdata.pred25$UL.pred)

tab.labels <- data.frame(
  x = c(1, 14),
  y = c(10, 10),
  text = c("observed", "predicted")
)

ggplot(newdata.pred25, aes(x = strdia.pred, y = fallecidos.pred)) +
  xlab("Mes") +
  ylab("Prediccion fallecidos canton de Goicoechea, San Jose")+

  geom_ribbon(aes(x = x, y = y, ymin = ll95, ymax = ul95), fill="chocolate1", alpha = 0.75, data = tab.ar1) +
  geom_ribbon(aes(x = x, y = y, ymin = ll95, ymax = ul95), fill="chocolate1", alpha = 0.5, data = tab.ar1[-(1:nrow(newdata.pred21)), ]) +

    geom_line(aes(x = x, y = y), linetype = 1, col = "blue", data = tab.ar1, size=1) +
      geom_point(shape = 20, alpha = 2, size=3) +

  geom_vline(xintercept = 12, linetype = "dashed", colour = "red") +
  geom_text(data = tab.labels, aes(x = x, y = y, label = text))
```

```{r}
newdata.pred25 <- newdata.pred27[351:364,]
```

```{r}
tab.ar1 <- data.frame(x = newdata.pred25$strdia.pred,
  y = newdata.pred25$RR.pred,
  ll95 = newdata.pred25$LL.pred,
  ul95 = newdata.pred25$UL.pred)

tab.labels <- data.frame(
  x = c(1, 14),
  y = c(10, 10),
  text = c("observed", "predicted")
)

ggplot(newdata.pred25, aes(x = strdia.pred, y = fallecidos.pred)) +
  xlab("Mes") +
  ylab("Prediccion fallecidos canton de Golfito, Puntarenas")+

  geom_ribbon(aes(x = x, y = y, ymin = ll95, ymax = ul95), fill="chocolate1", alpha = 0.75, data = tab.ar1) +
  geom_ribbon(aes(x = x, y = y, ymin = ll95, ymax = ul95), fill="chocolate1", alpha = 0.5, data = tab.ar1[-(1:nrow(newdata.pred21)), ]) +

    geom_line(aes(x = x, y = y), linetype = 1, col = "blue", data = tab.ar1, size=1) +
      geom_point(shape = 20, alpha = 2, size=3) +

  geom_vline(xintercept = 12, linetype = "dashed", colour = "red") +
  geom_text(data = tab.labels, aes(x = x, y = y, label = text))
```

```{r}
newdata.pred25 <- newdata.pred27[365:378,]
```

```{r}
tab.ar1 <- data.frame(x = newdata.pred25$strdia.pred,
  y = newdata.pred25$RR.pred,
  ll95 = newdata.pred25$LL.pred,
  ul95 = newdata.pred25$UL.pred)

tab.labels <- data.frame(
  x = c(1, 14),
  y = c(10, 10),
  text = c("observed", "predicted")
)

ggplot(newdata.pred25, aes(x = strdia.pred, y = fallecidos.pred)) +
  xlab("Mes") +
  ylab("Prediccion fallecidos canton de Grecia, Alajuela")+

  geom_ribbon(aes(x = x, y = y, ymin = ll95, ymax = ul95), fill="chocolate1", alpha = 0.75, data = tab.ar1) +
  geom_ribbon(aes(x = x, y = y, ymin = ll95, ymax = ul95), fill="chocolate1", alpha = 0.5, data = tab.ar1[-(1:nrow(newdata.pred21)), ]) +

    geom_line(aes(x = x, y = y), linetype = 1, col = "blue", data = tab.ar1, size=1) +
      geom_point(shape = 20, alpha = 2, size=3) +

  geom_vline(xintercept = 12, linetype = "dashed", colour = "red") +
  geom_text(data = tab.labels, aes(x = x, y = y, label = text))
```

```{r}
newdata.pred25 <- newdata.pred27[379:392,]
```

```{r}
tab.ar1 <- data.frame(x = newdata.pred25$strdia.pred,
  y = newdata.pred25$RR.pred,
  ll95 = newdata.pred25$LL.pred,
  ul95 = newdata.pred25$UL.pred)

tab.labels <- data.frame(
  x = c(1, 14),
  y = c(10, 10),
  text = c("observed", "predicted")
)

ggplot(newdata.pred25, aes(x = strdia.pred, y = fallecidos.pred)) +
  xlab("Mes") +
  ylab("Prediccion fallecidos canton de Guacimo, Limon")+

  geom_ribbon(aes(x = x, y = y, ymin = ll95, ymax = ul95), fill="chocolate1", alpha = 0.75, data = tab.ar1) +
  geom_ribbon(aes(x = x, y = y, ymin = ll95, ymax = ul95), fill="chocolate1", alpha = 0.5, data = tab.ar1[-(1:nrow(newdata.pred21)), ]) +

    geom_line(aes(x = x, y = y), linetype = 1, col = "blue", data = tab.ar1, size=1) +
      geom_point(shape = 20, alpha = 2, size=3) +

  geom_vline(xintercept = 12, linetype = "dashed", colour = "red") +
  geom_text(data = tab.labels, aes(x = x, y = y, label = text))
```

```{r}
newdata.pred25 <- newdata.pred27[393:406,]
```

```{r}
tab.ar1 <- data.frame(x = newdata.pred25$strdia.pred,
  y = newdata.pred25$RR.pred,
  ll95 = newdata.pred25$LL.pred,
  ul95 = newdata.pred25$UL.pred)

tab.labels <- data.frame(
  x = c(1, 14),
  y = c(10, 10),
  text = c("observed", "predicted")
)

ggplot(newdata.pred25, aes(x = strdia.pred, y = fallecidos.pred)) +
  xlab("Mes") +
  ylab("Prediccion fallecidos canton de Guatuso, Alajuela")+

  geom_ribbon(aes(x = x, y = y, ymin = ll95, ymax = ul95), fill="chocolate1", alpha = 0.75, data = tab.ar1) +
  geom_ribbon(aes(x = x, y = y, ymin = ll95, ymax = ul95), fill="chocolate1", alpha = 0.5, data = tab.ar1[-(1:nrow(newdata.pred21)), ]) +

    geom_line(aes(x = x, y = y), linetype = 1, col = "blue", data = tab.ar1, size=1) +
      geom_point(shape = 20, alpha = 2, size=3) +

  geom_vline(xintercept = 12, linetype = "dashed", colour = "red") +
  geom_text(data = tab.labels, aes(x = x, y = y, label = text))
```

```{r}
newdata.pred25 <- newdata.pred27[407:420,]
```

```{r}
tab.ar1 <- data.frame(x = newdata.pred25$strdia.pred,
  y = newdata.pred25$RR.pred,
  ll95 = newdata.pred25$LL.pred,
  ul95 = newdata.pred25$UL.pred)

tab.labels <- data.frame(
  x = c(1, 14),
  y = c(10, 10),
  text = c("observed", "predicted")
)

ggplot(newdata.pred25, aes(x = strdia.pred, y = fallecidos.pred)) +
  xlab("Mes") +
  ylab("Prediccion fallecidos canton de Heredia, Heredia")+

  geom_ribbon(aes(x = x, y = y, ymin = ll95, ymax = ul95), fill="chocolate1", alpha = 0.75, data = tab.ar1) +
  geom_ribbon(aes(x = x, y = y, ymin = ll95, ymax = ul95), fill="chocolate1", alpha = 0.5, data = tab.ar1[-(1:nrow(newdata.pred21)), ]) +

    geom_line(aes(x = x, y = y), linetype = 1, col = "blue", data = tab.ar1, size=1) +
      geom_point(shape = 20, alpha = 2, size=3) +

  geom_vline(xintercept = 12, linetype = "dashed", colour = "red") +
  geom_text(data = tab.labels, aes(x = x, y = y, label = text))
```

```{r}
newdata.pred25 <- newdata.pred27[421:434,]
```

```{r}
tab.ar1 <- data.frame(x = newdata.pred25$strdia.pred,
  y = newdata.pred25$RR.pred,
  ll95 = newdata.pred25$LL.pred,
  ul95 = newdata.pred25$UL.pred)

tab.labels <- data.frame(
  x = c(1, 14),
  y = c(10, 10),
  text = c("observed", "predicted")
)

ggplot(newdata.pred25, aes(x = strdia.pred, y = fallecidos.pred)) +
  xlab("Mes") +
  ylab("Prediccion fallecidos canton de Hojancha, Guanacaste")+

  geom_ribbon(aes(x = x, y = y, ymin = ll95, ymax = ul95), fill="chocolate1", alpha = 0.75, data = tab.ar1) +
  geom_ribbon(aes(x = x, y = y, ymin = ll95, ymax = ul95), fill="chocolate1", alpha = 0.5, data = tab.ar1[-(1:nrow(newdata.pred21)), ]) +

    geom_line(aes(x = x, y = y), linetype = 1, col = "blue", data = tab.ar1, size=1) +
      geom_point(shape = 20, alpha = 2, size=3) +

  geom_vline(xintercept = 12, linetype = "dashed", colour = "red") +
  geom_text(data = tab.labels, aes(x = x, y = y, label = text))
```

```{r}
newdata.pred25 <- newdata.pred27[435:448,]
```

```{r}
tab.ar1 <- data.frame(x = newdata.pred25$strdia.pred,
  y = newdata.pred25$RR.pred,
  ll95 = newdata.pred25$LL.pred,
  ul95 = newdata.pred25$UL.pred)

tab.labels <- data.frame(
  x = c(1, 14),
  y = c(10, 10),
  text = c("observed", "predicted")
)

ggplot(newdata.pred25, aes(x = strdia.pred, y = fallecidos.pred)) +
  geom_point(shape = 20, alpha = 0.3) +
  xlab("Mes") +
  ylab("Prediccion fallecidos canton de Jimenez, Cartago")+

  geom_ribbon(aes(x = x, y = y, ymin = ll95, ymax = ul95), fill="chocolate1", alpha = 0.75, data = tab.ar1) +
  geom_ribbon(aes(x = x, y = y, ymin = ll95, ymax = ul95), fill="chocolate1", alpha = 0.5, data = tab.ar1[-(1:nrow(newdata.pred21)), ]) +

    geom_line(aes(x = x, y = y), linetype = 1, col = "blue", data = tab.ar1, size=1) +
      geom_point(shape = 20, alpha = 2, size=3) +

  geom_vline(xintercept = 12, linetype = "dashed", colour = "red") +
  geom_text(data = tab.labels, aes(x = x, y = y, label = text))
```

```{r}
newdata.pred25 <- newdata.pred27[449:462,]
```

```{r}
tab.ar1 <- data.frame(x = newdata.pred25$strdia.pred,
  y = newdata.pred25$RR.pred,
  ll95 = newdata.pred25$LL.pred,
  ul95 = newdata.pred25$UL.pred)

tab.labels <- data.frame(
  x = c(1, 14),
  y = c(10, 10),
  text = c("observed", "predicted")
)

ggplot(newdata.pred25, aes(x = strdia.pred, y = fallecidos.pred)) +
  xlab("Mes") +
  ylab("Prediccion fallecidos canton de La Cruz, Guanacaste")+

  geom_ribbon(aes(x = x, y = y, ymin = ll95, ymax = ul95), fill="chocolate1", alpha = 0.75, data = tab.ar1) +
  geom_ribbon(aes(x = x, y = y, ymin = ll95, ymax = ul95), fill="chocolate1", alpha = 0.5, data = tab.ar1[-(1:nrow(newdata.pred21)), ]) +

    geom_line(aes(x = x, y = y), linetype = 1, col = "blue", data = tab.ar1, size=1) +
      geom_point(shape = 20, alpha = 2, size=3) +

  geom_vline(xintercept = 12, linetype = "dashed", colour = "red") +
  geom_text(data = tab.labels, aes(x = x, y = y, label = text))
```

```{r}
newdata.pred25 <- newdata.pred27[463:476,]
```

```{r}
tab.ar1 <- data.frame(x = newdata.pred25$strdia.pred,
  y = newdata.pred25$RR.pred,
  ll95 = newdata.pred25$LL.pred,
  ul95 = newdata.pred25$UL.pred)

tab.labels <- data.frame(
  x = c(1, 14),
  y = c(10, 10),
  text = c("observed", "predicted")
)

ggplot(newdata.pred25, aes(x = strdia.pred, y = fallecidos.pred)) +
  xlab("Mes") +
  ylab("Prediccion fallecidos canton de La Union, Cartago")+

  geom_ribbon(aes(x = x, y = y, ymin = ll95, ymax = ul95), fill="chocolate1", alpha = 0.75, data = tab.ar1) +
  geom_ribbon(aes(x = x, y = y, ymin = ll95, ymax = ul95), fill="chocolate1", alpha = 0.5, data = tab.ar1[-(1:nrow(newdata.pred21)), ]) +

    geom_line(aes(x = x, y = y), linetype = 1, col = "blue", data = tab.ar1, size=1) +
      geom_point(shape = 20, alpha = 2, size=3) +

  geom_vline(xintercept = 12, linetype = "dashed", colour = "red") +
  geom_text(data = tab.labels, aes(x = x, y = y, label = text))
```

```{r}
newdata.pred25 <- newdata.pred27[477:490,]
```

```{r}
tab.ar1 <- data.frame(x = newdata.pred25$strdia.pred,
  y = newdata.pred25$RR.pred,
  ll95 = newdata.pred25$LL.pred,
  ul95 = newdata.pred25$UL.pred)

tab.labels <- data.frame(
  x = c(1, 14),
  y = c(10, 10),
  text = c("observed", "predicted")
)

ggplot(newdata.pred25, aes(x = strdia.pred, y = fallecidos.pred)) +
  xlab("Mes") +
  ylab("Prediccion fallecidos canton de Leon Cortes, San Jose")+

  geom_ribbon(aes(x = x, y = y, ymin = ll95, ymax = ul95), fill="chocolate1", alpha = 0.75, data = tab.ar1) +
  geom_ribbon(aes(x = x, y = y, ymin = ll95, ymax = ul95), fill="chocolate1", alpha = 0.5, data = tab.ar1[-(1:nrow(newdata.pred21)), ]) +

    geom_line(aes(x = x, y = y), linetype = 1, col = "blue", data = tab.ar1, size=1) +
      geom_point(shape = 20, alpha = 2, size=3) +

  geom_vline(xintercept = 12, linetype = "dashed", colour = "red") +
  geom_text(data = tab.labels, aes(x = x, y = y, label = text))
```

```{r}
newdata.pred25 <- newdata.pred27[491:504,]
```

```{r}
tab.ar1 <- data.frame(x = newdata.pred25$strdia.pred,
  y = newdata.pred25$RR.pred,
  ll95 = newdata.pred25$LL.pred,
  ul95 = newdata.pred25$UL.pred)

tab.labels <- data.frame(
  x = c(1, 14),
  y = c(10, 10),
  text = c("observed", "predicted")
)

ggplot(newdata.pred25, aes(x = strdia.pred, y = fallecidos.pred)) +
  xlab("Mes") +
  ylab("Prediccion fallecidos canton de Liberia, Guanacaste")+

  geom_ribbon(aes(x = x, y = y, ymin = ll95, ymax = ul95), fill="chocolate1", alpha = 0.75, data = tab.ar1) +
  geom_ribbon(aes(x = x, y = y, ymin = ll95, ymax = ul95), fill="chocolate1", alpha = 0.5, data = tab.ar1[-(1:nrow(newdata.pred21)), ]) +

    geom_line(aes(x = x, y = y), linetype = 1, col = "blue", data = tab.ar1, size=1) +
      geom_point(shape = 20, alpha = 2, size=3) +

  geom_vline(xintercept = 12, linetype = "dashed", colour = "red") +
  geom_text(data = tab.labels, aes(x = x, y = y, label = text))
```

```{r}
newdata.pred25 <- newdata.pred27[505:518,]
```

```{r}
tab.ar1 <- data.frame(x = newdata.pred25$strdia.pred,
  y = newdata.pred25$RR.pred,
  ll95 = newdata.pred25$LL.pred,
  ul95 = newdata.pred25$UL.pred)

tab.labels <- data.frame(
  x = c(1, 14),
  y = c(10, 10),
  text = c("observed", "predicted")
)

ggplot(newdata.pred25, aes(x = strdia.pred, y = fallecidos.pred)) +
  xlab("Mes") +
  ylab("Prediccion fallecidos canton de Limon, Limon")+

  geom_ribbon(aes(x = x, y = y, ymin = ll95, ymax = ul95), fill="chocolate1", alpha = 0.75, data = tab.ar1) +
  geom_ribbon(aes(x = x, y = y, ymin = ll95, ymax = ul95), fill="chocolate1", alpha = 0.5, data = tab.ar1[-(1:nrow(newdata.pred21)), ]) +

    geom_line(aes(x = x, y = y), linetype = 1, col = "blue", data = tab.ar1, size=1) +
      geom_point(shape = 20, alpha = 2, size=3) +

  geom_vline(xintercept = 12, linetype = "dashed", colour = "red") +
  geom_text(data = tab.labels, aes(x = x, y = y, label = text))
```

```{r}
newdata.pred25 <- newdata.pred27[519:532,]
```

```{r}
tab.ar1 <- data.frame(x = newdata.pred25$strdia.pred,
  y = newdata.pred25$RR.pred,
  ll95 = newdata.pred25$LL.pred,
  ul95 = newdata.pred25$UL.pred)

tab.labels <- data.frame(
  x = c(1, 14),
  y = c(10, 10),
  text = c("observed", "predicted")
)

ggplot(newdata.pred25, aes(x = strdia.pred, y = fallecidos.pred)) +
  xlab("Mes") +
  ylab("Prediccion fallecidos canton de Los Chiles, Alajuela")+

  geom_ribbon(aes(x = x, y = y, ymin = ll95, ymax = ul95), fill="chocolate1", alpha = 0.75, data = tab.ar1) +
  geom_ribbon(aes(x = x, y = y, ymin = ll95, ymax = ul95), fill="chocolate1", alpha = 0.5, data = tab.ar1[-(1:nrow(newdata.pred21)), ]) +

    geom_line(aes(x = x, y = y), linetype = 1, col = "blue", data = tab.ar1, size=1) +
      geom_point(shape = 20, alpha = 2, size=3) +

  geom_vline(xintercept = 12, linetype = "dashed", colour = "red") +
  geom_text(data = tab.labels, aes(x = x, y = y, label = text))
```

```{r}
newdata.pred25 <- newdata.pred27[533:546,]
```

```{r}
tab.ar1 <- data.frame(x = newdata.pred25$strdia.pred,
  y = newdata.pred25$RR.pred,
  ll95 = newdata.pred25$LL.pred,
  ul95 = newdata.pred25$UL.pred)

tab.labels <- data.frame(
  x = c(1, 14),
  y = c(10, 10),
  text = c("observed", "predicted")
)

ggplot(newdata.pred25, aes(x = strdia.pred, y = fallecidos.pred)) +
  xlab("Mes") +
  ylab("Prediccion fallecidos canton de Matina, Limon")+

  geom_ribbon(aes(x = x, y = y, ymin = ll95, ymax = ul95), fill="chocolate1", alpha = 0.75, data = tab.ar1) +
  geom_ribbon(aes(x = x, y = y, ymin = ll95, ymax = ul95), fill="chocolate1", alpha = 0.5, data = tab.ar1[-(1:nrow(newdata.pred21)), ]) +

    geom_line(aes(x = x, y = y), linetype = 1, col = "blue", data = tab.ar1, size=1) +
      geom_point(shape = 20, alpha = 2, size=3) +

  geom_vline(xintercept = 12, linetype = "dashed", colour = "red") +
  geom_text(data = tab.labels, aes(x = x, y = y, label = text))
```

```{r}
newdata.pred25 <- newdata.pred27[547:560,]
```

```{r}
tab.ar1 <- data.frame(x = newdata.pred25$strdia.pred,
  y = newdata.pred25$RR.pred,
  ll95 = newdata.pred25$LL.pred,
  ul95 = newdata.pred25$UL.pred)

tab.labels <- data.frame(
  x = c(1, 14),
  y = c(10, 10),
  text = c("observed", "predicted")
)

ggplot(newdata.pred25, aes(x = strdia.pred, y = fallecidos.pred)) +
  xlab("Mes") +
  ylab("Prediccion fallecidos canton de Montes de Oca, San Jose")+

  geom_ribbon(aes(x = x, y = y, ymin = ll95, ymax = ul95), fill="chocolate1", alpha = 0.75, data = tab.ar1) +
  geom_ribbon(aes(x = x, y = y, ymin = ll95, ymax = ul95), fill="chocolate1", alpha = 0.5, data = tab.ar1[-(1:nrow(newdata.pred21)), ]) +

    geom_line(aes(x = x, y = y), linetype = 1, col = "blue", data = tab.ar1, size=1) +
      geom_point(shape = 20, alpha = 2, size=3) +

  geom_vline(xintercept = 12, linetype = "dashed", colour = "red") +
  geom_text(data = tab.labels, aes(x = x, y = y, label = text))
```

```{r}
newdata.pred25 <- newdata.pred27[561:574,]
```

```{r}
tab.ar1 <- data.frame(x = newdata.pred25$strdia.pred,
  y = newdata.pred25$RR.pred,
  ll95 = newdata.pred25$LL.pred,
  ul95 = newdata.pred25$UL.pred)

tab.labels <- data.frame(
  x = c(1, 14),
  y = c(10, 10),
  text = c("observed", "predicted")
)

ggplot(newdata.pred25, aes(x = strdia.pred, y = fallecidos.pred)) +
  xlab("Mes") +
  ylab("Prediccion fallecidos canton de Montes de Oro, Puntarenas")+

  geom_ribbon(aes(x = x, y = y, ymin = ll95, ymax = ul95), fill="chocolate1", alpha = 0.75, data = tab.ar1) +
  geom_ribbon(aes(x = x, y = y, ymin = ll95, ymax = ul95), fill="chocolate1", alpha = 0.5, data = tab.ar1[-(1:nrow(newdata.pred21)), ]) +

    geom_line(aes(x = x, y = y), linetype = 1, col = "blue", data = tab.ar1, size=1) +
      geom_point(shape = 20, alpha = 2, size=3) +

  geom_vline(xintercept = 12, linetype = "dashed", colour = "red") +
  geom_text(data = tab.labels, aes(x = x, y = y, label = text))
```

```{r}
newdata.pred25 <- newdata.pred27[575:588,]
```

```{r}
tab.ar1 <- data.frame(x = newdata.pred25$strdia.pred,
  y = newdata.pred25$RR.pred,
  ll95 = newdata.pred25$LL.pred,
  ul95 = newdata.pred25$UL.pred)

tab.labels <- data.frame(
  x = c(1, 14),
  y = c(10, 10),
  text = c("observed", "predicted")
)

ggplot(newdata.pred25, aes(x = strdia.pred, y = fallecidos.pred)) +
  xlab("Mes") +
  ylab("Prediccion fallecidos canton de Mora, San Jose")+

  geom_ribbon(aes(x = x, y = y, ymin = ll95, ymax = ul95), fill="chocolate1", alpha = 0.75, data = tab.ar1) +
  geom_ribbon(aes(x = x, y = y, ymin = ll95, ymax = ul95), fill="chocolate1", alpha = 0.5, data = tab.ar1[-(1:nrow(newdata.pred21)), ]) +

    geom_line(aes(x = x, y = y), linetype = 1, col = "blue", data = tab.ar1, size=1) +
      geom_point(shape = 20, alpha = 2, size=3) +

  geom_vline(xintercept = 12, linetype = "dashed", colour = "red") +
  geom_text(data = tab.labels, aes(x = x, y = y, label = text))
```

```{r}
newdata.pred25 <- newdata.pred27[589:602,]
```

```{r}
tab.ar1 <- data.frame(x = newdata.pred25$strdia.pred,
  y = newdata.pred25$RR.pred,
  ll95 = newdata.pred25$LL.pred,
  ul95 = newdata.pred25$UL.pred)

tab.labels <- data.frame(
  x = c(1, 14),
  y = c(10, 10),
  text = c("observed", "predicted")
)

ggplot(newdata.pred25, aes(x = strdia.pred, y = fallecidos.pred)) +
  xlab("Mes") +
  ylab("Prediccion fallecidos canton de Moravia, San Jose")+

  geom_ribbon(aes(x = x, y = y, ymin = ll95, ymax = ul95), fill="chocolate1", alpha = 0.75, data = tab.ar1) +
  geom_ribbon(aes(x = x, y = y, ymin = ll95, ymax = ul95), fill="chocolate1", alpha = 0.5, data = tab.ar1[-(1:nrow(newdata.pred21)), ]) +

    geom_line(aes(x = x, y = y), linetype = 1, col = "blue", data = tab.ar1, size=1) +
      geom_point(shape = 20, alpha = 2, size=3) +

  geom_vline(xintercept = 12, linetype = "dashed", colour = "red") +
  geom_text(data = tab.labels, aes(x = x, y = y, label = text))
```

```{r}
newdata.pred25 <- newdata.pred27[603:616,]
```

```{r}
tab.ar1 <- data.frame(x = newdata.pred25$strdia.pred,
  y = newdata.pred25$RR.pred,
  ll95 = newdata.pred25$LL.pred,
  ul95 = newdata.pred25$UL.pred)

tab.labels <- data.frame(
  x = c(1, 14),
  y = c(10, 10),
  text = c("observed", "predicted")
)

ggplot(newdata.pred25, aes(x = strdia.pred, y = fallecidos.pred)) +
  xlab("Mes") +
  ylab("Prediccion fallecidos canton de Nandayure, Guanacaste")+

  geom_ribbon(aes(x = x, y = y, ymin = ll95, ymax = ul95), fill="chocolate1", alpha = 0.75, data = tab.ar1) +
  geom_ribbon(aes(x = x, y = y, ymin = ll95, ymax = ul95), fill="chocolate1", alpha = 0.5, data = tab.ar1[-(1:nrow(newdata.pred21)), ]) +

    geom_line(aes(x = x, y = y), linetype = 1, col = "blue", data = tab.ar1, size=1) +
      geom_point(shape = 20, alpha = 2, size=3) +

  geom_vline(xintercept = 12, linetype = "dashed", colour = "red") +
  geom_text(data = tab.labels, aes(x = x, y = y, label = text))
```

```{r}
newdata.pred25 <- newdata.pred27[617:630,]
```

```{r}
tab.ar1 <- data.frame(x = newdata.pred25$strdia.pred,
  y = newdata.pred25$RR.pred,
  ll95 = newdata.pred25$LL.pred,
  ul95 = newdata.pred25$UL.pred)

tab.labels <- data.frame(
  x = c(1, 14),
  y = c(10, 10),
  text = c("observed", "predicted")
)

ggplot(newdata.pred25, aes(x = strdia.pred, y = fallecidos.pred)) +
  xlab("Mes") +
  ylab("Prediccion fallecidos canton de Naranjo, Alajuela")+

  geom_ribbon(aes(x = x, y = y, ymin = ll95, ymax = ul95), fill="chocolate1", alpha = 0.75, data = tab.ar1) +
  geom_ribbon(aes(x = x, y = y, ymin = ll95, ymax = ul95), fill="chocolate1", alpha = 0.5, data = tab.ar1[-(1:nrow(newdata.pred21)), ]) +

    geom_line(aes(x = x, y = y), linetype = 1, col = "blue", data = tab.ar1, size=1) +
      geom_point(shape = 20, alpha = 2, size=3) +

  geom_vline(xintercept = 12, linetype = "dashed", colour = "red") +
  geom_text(data = tab.labels, aes(x = x, y = y, label = text))
```


```{r}
newdata.pred25 <- newdata.pred27[631:644,]
```

```{r}
tab.ar1 <- data.frame(x = newdata.pred25$strdia.pred,
  y = newdata.pred25$RR.pred,
  ll95 = newdata.pred25$LL.pred,
  ul95 = newdata.pred25$UL.pred)

tab.labels <- data.frame(
  x = c(1, 14),
  y = c(10, 10),
  text = c("observed", "predicted")
)

ggplot(newdata.pred25, aes(x = strdia.pred, y = fallecidos.pred)) +
  xlab("Mes") +
  ylab("Prediccion fallecidos canton de Nicoya, Guanacaste")+

  geom_ribbon(aes(x = x, y = y, ymin = ll95, ymax = ul95), fill="chocolate1", alpha = 0.75, data = tab.ar1) +
  geom_ribbon(aes(x = x, y = y, ymin = ll95, ymax = ul95), fill="chocolate1", alpha = 0.5, data = tab.ar1[-(1:nrow(newdata.pred21)), ]) +

    geom_line(aes(x = x, y = y), linetype = 1, col = "blue", data = tab.ar1, size=1) +
      geom_point(shape = 20, alpha = 2, size=3) +

  geom_vline(xintercept = 12, linetype = "dashed", colour = "red") +
  geom_text(data = tab.labels, aes(x = x, y = y, label = text))
```

```{r}
newdata.pred25 <- newdata.pred27[645:658,]
```

```{r}
tab.ar1 <- data.frame(x = newdata.pred25$strdia.pred,
  y = newdata.pred25$RR.pred,
  ll95 = newdata.pred25$LL.pred,
  ul95 = newdata.pred25$UL.pred)

tab.labels <- data.frame(
  x = c(1, 14),
  y = c(10, 10),
  text = c("observed", "predicted")
)

ggplot(newdata.pred25, aes(x = strdia.pred, y = fallecidos.pred)) +
  xlab("Mes") +
  ylab("Prediccion fallecidos canton de Oreamuno, Cartago")+

  geom_ribbon(aes(x = x, y = y, ymin = ll95, ymax = ul95), fill="chocolate1", alpha = 0.75, data = tab.ar1) +
  geom_ribbon(aes(x = x, y = y, ymin = ll95, ymax = ul95), fill="chocolate1", alpha = 0.5, data = tab.ar1[-(1:nrow(newdata.pred21)), ]) +

    geom_line(aes(x = x, y = y), linetype = 1, col = "blue", data = tab.ar1, size=1) +
      geom_point(shape = 20, alpha = 2, size=3) +

  geom_vline(xintercept = 12, linetype = "dashed", colour = "red") +
  geom_text(data = tab.labels, aes(x = x, y = y, label = text))
```

```{r}
newdata.pred25 <- newdata.pred27[659:672,]
```

```{r}
tab.ar1 <- data.frame(x = newdata.pred25$strdia.pred,
  y = newdata.pred25$RR.pred,
  ll95 = newdata.pred25$LL.pred,
  ul95 = newdata.pred25$UL.pred)

tab.labels <- data.frame(
  x = c(1, 14),
  y = c(10, 10),
  text = c("observed", "predicted")
)

ggplot(newdata.pred25, aes(x = strdia.pred, y = fallecidos.pred)) +
  xlab("Mes") +
  ylab("Prediccion fallecidos canton de Orotina, Alajuela")+

  geom_ribbon(aes(x = x, y = y, ymin = ll95, ymax = ul95), fill="chocolate1", alpha = 0.75, data = tab.ar1) +
  geom_ribbon(aes(x = x, y = y, ymin = ll95, ymax = ul95), fill="chocolate1", alpha = 0.5, data = tab.ar1[-(1:nrow(newdata.pred21)), ]) +

    geom_line(aes(x = x, y = y), linetype = 1, col = "blue", data = tab.ar1, size=1) +
      geom_point(shape = 20, alpha = 2, size=3) +

  geom_vline(xintercept = 12, linetype = "dashed", colour = "red") +
  geom_text(data = tab.labels, aes(x = x, y = y, label = text))
```

```{r}
newdata.pred25 <- newdata.pred27[673:686,]
```

```{r}
tab.ar1 <- data.frame(x = newdata.pred25$strdia.pred,
  y = newdata.pred25$RR.pred,
  ll95 = newdata.pred25$LL.pred,
  ul95 = newdata.pred25$UL.pred)

tab.labels <- data.frame(
  x = c(1, 14),
  y = c(10, 10),
  text = c("observed", "predicted")
)

ggplot(newdata.pred25, aes(x = strdia.pred, y = fallecidos.pred)) +
  xlab("Mes") +
  ylab("Prediccion fallecidos canton de Osa, Puntarenas")+

  geom_ribbon(aes(x = x, y = y, ymin = ll95, ymax = ul95), fill="chocolate1", alpha = 0.75, data = tab.ar1) +
  geom_ribbon(aes(x = x, y = y, ymin = ll95, ymax = ul95), fill="chocolate1", alpha = 0.5, data = tab.ar1[-(1:nrow(newdata.pred21)), ]) +

    geom_line(aes(x = x, y = y), linetype = 1, col = "blue", data = tab.ar1, size=1) +
      geom_point(shape = 20, alpha = 2, size=3) +

  geom_vline(xintercept = 12, linetype = "dashed", colour = "red") +
  geom_text(data = tab.labels, aes(x = x, y = y, label = text))
```

```{r}
newdata.pred25 <- newdata.pred27[687:700,]
```

```{r}
tab.ar1 <- data.frame(x = newdata.pred25$strdia.pred,
  y = newdata.pred25$RR.pred,
  ll95 = newdata.pred25$LL.pred,
  ul95 = newdata.pred25$UL.pred)

tab.labels <- data.frame(
  x = c(1, 14),
  y = c(10, 10),
  text = c("observed", "predicted")
)

ggplot(newdata.pred25, aes(x = strdia.pred, y = fallecidos.pred)) +
  xlab("Mes") +
  ylab("Prediccion fallecidos canton de Palmares, Alajuela")+

  geom_ribbon(aes(x = x, y = y, ymin = ll95, ymax = ul95), fill="chocolate1", alpha = 0.75, data = tab.ar1) +
  geom_ribbon(aes(x = x, y = y, ymin = ll95, ymax = ul95), fill="chocolate1", alpha = 0.5, data = tab.ar1[-(1:nrow(newdata.pred21)), ]) +

    geom_line(aes(x = x, y = y), linetype = 1, col = "blue", data = tab.ar1, size=1) +
      geom_point(shape = 20, alpha = 2, size=3) +

  geom_vline(xintercept = 12, linetype = "dashed", colour = "red") +
  geom_text(data = tab.labels, aes(x = x, y = y, label = text))
```

```{r}
newdata.pred25 <- newdata.pred27[701:714,]
```

```{r}
tab.ar1 <- data.frame(x = newdata.pred25$strdia.pred,
  y = newdata.pred25$RR.pred,
  ll95 = newdata.pred25$LL.pred,
  ul95 = newdata.pred25$UL.pred)

tab.labels <- data.frame(
  x = c(1, 14),
  y = c(10, 10),
  text = c("observed", "predicted")
)

ggplot(newdata.pred25, aes(x = strdia.pred, y = fallecidos.pred)) +
  xlab("Mes") +
  ylab("Prediccion fallecidos canton de Paraiso, Cartago")+

  geom_ribbon(aes(x = x, y = y, ymin = ll95, ymax = ul95), fill="chocolate1", alpha = 0.75, data = tab.ar1) +
  geom_ribbon(aes(x = x, y = y, ymin = ll95, ymax = ul95), fill="chocolate1", alpha = 0.5, data = tab.ar1[-(1:nrow(newdata.pred21)), ]) +

    geom_line(aes(x = x, y = y), linetype = 1, col = "blue", data = tab.ar1, size=1) +
      geom_point(shape = 20, alpha = 2, size=3) +

  geom_vline(xintercept = 12, linetype = "dashed", colour = "red") +
  geom_text(data = tab.labels, aes(x = x, y = y, label = text))
```

```{r}
newdata.pred25 <- newdata.pred27[715:728,]
```

```{r}
tab.ar1 <- data.frame(x = newdata.pred25$strdia.pred,
  y = newdata.pred25$RR.pred,
  ll95 = newdata.pred25$LL.pred,
  ul95 = newdata.pred25$UL.pred)

tab.labels <- data.frame(
  x = c(1, 14),
  y = c(10, 10),
  text = c("observed", "predicted")
)

ggplot(newdata.pred25, aes(x = strdia.pred, y = fallecidos.pred)) +
  xlab("Mes") +
  ylab("Prediccion fallecidos canton de Parrita, Puntarenas")+

  geom_ribbon(aes(x = x, y = y, ymin = ll95, ymax = ul95), fill="chocolate1", alpha = 0.75, data = tab.ar1) +
  geom_ribbon(aes(x = x, y = y, ymin = ll95, ymax = ul95), fill="chocolate1", alpha = 0.5, data = tab.ar1[-(1:nrow(newdata.pred21)), ]) +

    geom_line(aes(x = x, y = y), linetype = 1, col = "blue", data = tab.ar1, size=1) +
      geom_point(shape = 20, alpha = 2, size=3) +

  geom_vline(xintercept = 12, linetype = "dashed", colour = "red") +
  geom_text(data = tab.labels, aes(x = x, y = y, label = text))
```

```{r}
newdata.pred25 <- newdata.pred27[729:742,]
```

```{r}
tab.ar1 <- data.frame(x = newdata.pred25$strdia.pred,
  y = newdata.pred25$RR.pred,
  ll95 = newdata.pred25$LL.pred,
  ul95 = newdata.pred25$UL.pred)

tab.labels <- data.frame(
  x = c(1, 14),
  y = c(10, 10),
  text = c("observed", "predicted")
)

ggplot(newdata.pred25, aes(x = strdia.pred, y = fallecidos.pred)) +
  xlab("Mes") +
  ylab("Prediccion fallecidos canton de Perez Zeledon, San Jose")+

  geom_ribbon(aes(x = x, y = y, ymin = ll95, ymax = ul95), fill="chocolate1", alpha = 0.75, data = tab.ar1) +
  geom_ribbon(aes(x = x, y = y, ymin = ll95, ymax = ul95), fill="chocolate1", alpha = 0.5, data = tab.ar1[-(1:nrow(newdata.pred21)), ]) +

    geom_line(aes(x = x, y = y), linetype = 1, col = "blue", data = tab.ar1, size=1) +
      geom_point(shape = 20, alpha = 2, size=3) +

  geom_vline(xintercept = 12, linetype = "dashed", colour = "red") +
  geom_text(data = tab.labels, aes(x = x, y = y, label = text))
```

```{r}
newdata.pred25 <- newdata.pred27[743:756,]
```

```{r}
tab.ar1 <- data.frame(x = newdata.pred25$strdia.pred,
  y = newdata.pred25$RR.pred,
  ll95 = newdata.pred25$LL.pred,
  ul95 = newdata.pred25$UL.pred)

tab.labels <- data.frame(
  x = c(1, 14),
  y = c(10, 10),
  text = c("observed", "predicted")
)

ggplot(newdata.pred25, aes(x = strdia.pred, y = fallecidos.pred)) +
  xlab("Mes") +
  ylab("Prediccion fallecidos canton de Poas, Alajuela")+

  geom_ribbon(aes(x = x, y = y, ymin = ll95, ymax = ul95), fill="chocolate1", alpha = 0.75, data = tab.ar1) +
  geom_ribbon(aes(x = x, y = y, ymin = ll95, ymax = ul95), fill="chocolate1", alpha = 0.5, data = tab.ar1[-(1:nrow(newdata.pred21)), ]) +

    geom_line(aes(x = x, y = y), linetype = 1, col = "blue", data = tab.ar1, size=1) +
      geom_point(shape = 20, alpha = 2, size=3) +

  geom_vline(xintercept = 12, linetype = "dashed", colour = "red") +
  geom_text(data = tab.labels, aes(x = x, y = y, label = text))
```

```{r}
newdata.pred25 <- newdata.pred27[757:770,]
```

```{r}
tab.ar1 <- data.frame(x = newdata.pred25$strdia.pred,
  y = newdata.pred25$RR.pred,
  ll95 = newdata.pred25$LL.pred,
  ul95 = newdata.pred25$UL.pred)

tab.labels <- data.frame(
  x = c(1, 14),
  y = c(10, 10),
  text = c("observed", "predicted")
)

ggplot(newdata.pred25, aes(x = strdia.pred, y = fallecidos.pred)) +
  xlab("Mes") +
  ylab("Prediccion fallecidos canton de Pococi, Limon")+

  geom_ribbon(aes(x = x, y = y, ymin = ll95, ymax = ul95), fill="chocolate1", alpha = 0.75, data = tab.ar1) +
  geom_ribbon(aes(x = x, y = y, ymin = ll95, ymax = ul95), fill="chocolate1", alpha = 0.5, data = tab.ar1[-(1:nrow(newdata.pred21)), ]) +

    geom_line(aes(x = x, y = y), linetype = 1, col = "blue", data = tab.ar1, size=1) +
      geom_point(shape = 20, alpha = 2, size=3) +

  geom_vline(xintercept = 12, linetype = "dashed", colour = "red") +
  geom_text(data = tab.labels, aes(x = x, y = y, label = text))
```

```{r}
newdata.pred25 <- newdata.pred27[771:784,]
```

```{r}
tab.ar1 <- data.frame(x = newdata.pred25$strdia.pred,
  y = newdata.pred25$RR.pred,
  ll95 = newdata.pred25$LL.pred,
  ul95 = newdata.pred25$UL.pred)

tab.labels <- data.frame(
  x = c(1, 14),
  y = c(10, 10),
  text = c("observed", "predicted")
)

ggplot(newdata.pred25, aes(x = strdia.pred, y = fallecidos.pred)) +
  xlab("Mes") +
  ylab("Prediccion fallecidos canton de Puntarenas, Puntarenas")+

  geom_ribbon(aes(x = x, y = y, ymin = ll95, ymax = ul95), fill="chocolate1", alpha = 0.75, data = tab.ar1) +
  geom_ribbon(aes(x = x, y = y, ymin = ll95, ymax = ul95), fill="chocolate1", alpha = 0.5, data = tab.ar1[-(1:nrow(newdata.pred21)), ]) +

    geom_line(aes(x = x, y = y), linetype = 1, col = "blue", data = tab.ar1, size=1) +
      geom_point(shape = 20, alpha = 2, size=3) +

  geom_vline(xintercept = 12, linetype = "dashed", colour = "red") +
  geom_text(data = tab.labels, aes(x = x, y = y, label = text))
```

```{r}
newdata.pred25 <- newdata.pred27[785:798,]
```

```{r}
tab.ar1 <- data.frame(x = newdata.pred25$strdia.pred,
  y = newdata.pred25$RR.pred,
  ll95 = newdata.pred25$LL.pred,
  ul95 = newdata.pred25$UL.pred)

tab.labels <- data.frame(
  x = c(1, 14),
  y = c(10, 10),
  text = c("observed", "predicted")
)

ggplot(newdata.pred25, aes(x = strdia.pred, y = fallecidos.pred)) +
  xlab("Mes") +
  ylab("Prediccion fallecidos canton de Puriscal, San Jose")+

  geom_ribbon(aes(x = x, y = y, ymin = ll95, ymax = ul95), fill="chocolate1", alpha = 0.75, data = tab.ar1) +
  geom_ribbon(aes(x = x, y = y, ymin = ll95, ymax = ul95), fill="chocolate1", alpha = 0.5, data = tab.ar1[-(1:nrow(newdata.pred21)), ]) +

    geom_line(aes(x = x, y = y), linetype = 1, col = "blue", data = tab.ar1, size=1) +
      geom_point(shape = 20, alpha = 2, size=3) +

  geom_vline(xintercept = 12, linetype = "dashed", colour = "red") +
  geom_text(data = tab.labels, aes(x = x, y = y, label = text))
```

```{r}
newdata.pred25 <- newdata.pred27[799:812,]
```

```{r}
tab.ar1 <- data.frame(x = newdata.pred25$strdia.pred,
  y = newdata.pred25$RR.pred,
  ll95 = newdata.pred25$LL.pred,
  ul95 = newdata.pred25$UL.pred)

tab.labels <- data.frame(
  x = c(1, 14),
  y = c(10, 10),
  text = c("observed", "predicted")
)

ggplot(newdata.pred25, aes(x = strdia.pred, y = fallecidos.pred)) +
  xlab("Mes") +
  ylab("Prediccion fallecidos canton de Quepos, Puntarenas")+

  geom_ribbon(aes(x = x, y = y, ymin = ll95, ymax = ul95), fill="chocolate1", alpha = 0.75, data = tab.ar1) +
  geom_ribbon(aes(x = x, y = y, ymin = ll95, ymax = ul95), fill="chocolate1", alpha = 0.5, data = tab.ar1[-(1:nrow(newdata.pred21)), ]) +

    geom_line(aes(x = x, y = y), linetype = 1, col = "blue", data = tab.ar1, size=1) +
      geom_point(shape = 20, alpha = 2, size=3) +

  geom_vline(xintercept = 12, linetype = "dashed", colour = "red") +
  geom_text(data = tab.labels, aes(x = x, y = y, label = text))
```

```{r}
newdata.pred25 <- newdata.pred27[813:826,]
```

```{r}
tab.ar1 <- data.frame(x = newdata.pred25$strdia.pred,
  y = newdata.pred25$RR.pred,
  ll95 = newdata.pred25$LL.pred,
  ul95 = newdata.pred25$UL.pred)

tab.labels <- data.frame(
  x = c(1, 14),
  y = c(10, 10),
  text = c("observed", "predicted")
)

ggplot(newdata.pred25, aes(x = strdia.pred, y = fallecidos.pred)) +
  xlab("Mes") +
  ylab("Prediccion fallecidos canton de Rio Cuarto, Alajuela")+

  geom_ribbon(aes(x = x, y = y, ymin = ll95, ymax = ul95), fill="chocolate1", alpha = 0.75, data = tab.ar1) +
  geom_ribbon(aes(x = x, y = y, ymin = ll95, ymax = ul95), fill="chocolate1", alpha = 0.5, data = tab.ar1[-(1:nrow(newdata.pred21)), ]) +

    geom_line(aes(x = x, y = y), linetype = 1, col = "blue", data = tab.ar1, size=1) +
      geom_point(shape = 20, alpha = 2, size=3) +

  geom_vline(xintercept = 12, linetype = "dashed", colour = "red") +
  geom_text(data = tab.labels, aes(x = x, y = y, label = text))
```

```{r}
newdata.pred25 <- newdata.pred27[827:840,]
```

```{r}
tab.ar1 <- data.frame(x = newdata.pred25$strdia.pred,
  y = newdata.pred25$RR.pred,
  ll95 = newdata.pred25$LL.pred,
  ul95 = newdata.pred25$UL.pred)

tab.labels <- data.frame(
  x = c(1, 14),
  y = c(10, 10),
  text = c("observed", "predicted")
)

ggplot(newdata.pred25, aes(x = strdia.pred, y = fallecidos.pred)) +
  xlab("Mes") +
  ylab("Prediccion fallecidos canton de San Carlos, Alajuela")+

  geom_ribbon(aes(x = x, y = y, ymin = ll95, ymax = ul95), fill="chocolate1", alpha = 0.75, data = tab.ar1) +
  geom_ribbon(aes(x = x, y = y, ymin = ll95, ymax = ul95), fill="chocolate1", alpha = 0.5, data = tab.ar1[-(1:nrow(newdata.pred21)), ]) +

    geom_line(aes(x = x, y = y), linetype = 1, col = "blue", data = tab.ar1, size=1) +
      geom_point(shape = 20, alpha = 2, size=3) +

  geom_vline(xintercept = 12, linetype = "dashed", colour = "red") +
  geom_text(data = tab.labels, aes(x = x, y = y, label = text))
```

```{r}
newdata.pred25 <- newdata.pred27[841:854,]
```

```{r}
tab.ar1 <- data.frame(x = newdata.pred25$strdia.pred,
  y = newdata.pred25$RR.pred,
  ll95 = newdata.pred25$LL.pred,
  ul95 = newdata.pred25$UL.pred)

tab.labels <- data.frame(
  x = c(1, 14),
  y = c(10, 10),
  text = c("observed", "predicted")
)

ggplot(newdata.pred25, aes(x = strdia.pred, y = fallecidos.pred)) +
  xlab("Mes") +
  ylab("Prediccion fallecidos canton de San Isidro, Heredia")+

  geom_ribbon(aes(x = x, y = y, ymin = ll95, ymax = ul95), fill="chocolate1", alpha = 0.75, data = tab.ar1) +
  geom_ribbon(aes(x = x, y = y, ymin = ll95, ymax = ul95), fill="chocolate1", alpha = 0.5, data = tab.ar1[-(1:nrow(newdata.pred21)), ]) +

    geom_line(aes(x = x, y = y), linetype = 1, col = "blue", data = tab.ar1, size=1) +
      geom_point(shape = 20, alpha = 2, size=3) +

  geom_vline(xintercept = 12, linetype = "dashed", colour = "red") +
  geom_text(data = tab.labels, aes(x = x, y = y, label = text))
```

```{r}
newdata.pred25 <- newdata.pred27[855:868,]
```

```{r}
tab.ar1 <- data.frame(x = newdata.pred25$strdia.pred,
  y = newdata.pred25$RR.pred,
  ll95 = newdata.pred25$LL.pred,
  ul95 = newdata.pred25$UL.pred)

tab.labels <- data.frame(
  x = c(1, 14),
  y = c(10, 10),
  text = c("observed", "predicted")
)

ggplot(newdata.pred25, aes(x = strdia.pred, y = fallecidos.pred)) +
  xlab("Mes") +
  ylab("Prediccion fallecidos canton de San Jose, San Jose")+

  geom_ribbon(aes(x = x, y = y, ymin = ll95, ymax = ul95), fill="chocolate1", alpha = 0.75, data = tab.ar1) +
  geom_ribbon(aes(x = x, y = y, ymin = ll95, ymax = ul95), fill="chocolate1", alpha = 0.5, data = tab.ar1[-(1:nrow(newdata.pred21)), ]) +

    geom_line(aes(x = x, y = y), linetype = 1, col = "blue", data = tab.ar1, size=1) +
      geom_point(shape = 20, alpha = 2, size=3) +

  geom_vline(xintercept = 12, linetype = "dashed", colour = "red") +
  geom_text(data = tab.labels, aes(x = x, y = y, label = text))
```

```{r}
newdata.pred25 <- newdata.pred27[869:882,]
```

```{r}
tab.ar1 <- data.frame(x = newdata.pred25$strdia.pred,
  y = newdata.pred25$RR.pred,
  ll95 = newdata.pred25$LL.pred,
  ul95 = newdata.pred25$UL.pred)

tab.labels <- data.frame(
  x = c(1, 14),
  y = c(10, 10),
  text = c("observed", "predicted")
)

ggplot(newdata.pred25, aes(x = strdia.pred, y = fallecidos.pred)) +
  xlab("Mes") +
  ylab("Prediccion fallecidos canton de San Mateo, Alajuela")+

  geom_ribbon(aes(x = x, y = y, ymin = ll95, ymax = ul95), fill="chocolate1", alpha = 0.75, data = tab.ar1) +
  geom_ribbon(aes(x = x, y = y, ymin = ll95, ymax = ul95), fill="chocolate1", alpha = 0.5, data = tab.ar1[-(1:nrow(newdata.pred21)), ]) +

    geom_line(aes(x = x, y = y), linetype = 1, col = "blue", data = tab.ar1, size=1) +
      geom_point(shape = 20, alpha = 2, size=3) +

  geom_vline(xintercept = 12, linetype = "dashed", colour = "red") +
  geom_text(data = tab.labels, aes(x = x, y = y, label = text))
```

```{r}
newdata.pred25 <- newdata.pred27[883:896,]
```

```{r}
tab.ar1 <- data.frame(x = newdata.pred25$strdia.pred,
  y = newdata.pred25$RR.pred,
  ll95 = newdata.pred25$LL.pred,
  ul95 = newdata.pred25$UL.pred)

tab.labels <- data.frame(
  x = c(1, 14),
  y = c(10, 10),
  text = c("observed", "predicted")
)

ggplot(newdata.pred25, aes(x = strdia.pred, y = fallecidos.pred)) +
  xlab("Mes") +
  ylab("Prediccion fallecidos canton de San Pablo, Heredia")+

  geom_ribbon(aes(x = x, y = y, ymin = ll95, ymax = ul95), fill="chocolate1", alpha = 0.75, data = tab.ar1) +
  geom_ribbon(aes(x = x, y = y, ymin = ll95, ymax = ul95), fill="chocolate1", alpha = 0.5, data = tab.ar1[-(1:nrow(newdata.pred21)), ]) +

    geom_line(aes(x = x, y = y), linetype = 1, col = "blue", data = tab.ar1, size=1) +
      geom_point(shape = 20, alpha = 2, size=3) +

  geom_vline(xintercept = 12, linetype = "dashed", colour = "red") +
  geom_text(data = tab.labels, aes(x = x, y = y, label = text))
```

```{r}
newdata.pred25 <- newdata.pred27[897:910,]
```

```{r}
tab.ar1 <- data.frame(x = newdata.pred25$strdia.pred,
  y = newdata.pred25$RR.pred,
  ll95 = newdata.pred25$LL.pred,
  ul95 = newdata.pred25$UL.pred)

tab.labels <- data.frame(
  x = c(1, 14),
  y = c(10, 10),
  text = c("observed", "predicted")
)

ggplot(newdata.pred25, aes(x = strdia.pred, y = fallecidos.pred)) +
  xlab("Mes") +
  ylab("Prediccion fallecidos canton de San Rafael, Heredia")+

  geom_ribbon(aes(x = x, y = y, ymin = ll95, ymax = ul95), fill="chocolate1", alpha = 0.75, data = tab.ar1) +
  geom_ribbon(aes(x = x, y = y, ymin = ll95, ymax = ul95), fill="chocolate1", alpha = 0.5, data = tab.ar1[-(1:nrow(newdata.pred21)), ]) +

    geom_line(aes(x = x, y = y), linetype = 1, col = "blue", data = tab.ar1, size=1) +
      geom_point(shape = 20, alpha = 2, size=3) +

  geom_vline(xintercept = 12, linetype = "dashed", colour = "red") +
  geom_text(data = tab.labels, aes(x = x, y = y, label = text))
```

```{r}
newdata.pred25 <- newdata.pred27[911:924,]
```

```{r}
tab.ar1 <- data.frame(x = newdata.pred25$strdia.pred,
  y = newdata.pred25$RR.pred,
  ll95 = newdata.pred25$LL.pred,
  ul95 = newdata.pred25$UL.pred)

tab.labels <- data.frame(
  x = c(1, 14),
  y = c(10, 10),
  text = c("observed", "predicted")
)

ggplot(newdata.pred25, aes(x = strdia.pred, y = fallecidos.pred)) +
  xlab("Mes") +
  ylab("Prediccion fallecidos canton de San Ramon, Alajuela")+

  geom_ribbon(aes(x = x, y = y, ymin = ll95, ymax = ul95), fill="chocolate1", alpha = 0.75, data = tab.ar1) +
  geom_ribbon(aes(x = x, y = y, ymin = ll95, ymax = ul95), fill="chocolate1", alpha = 0.5, data = tab.ar1[-(1:nrow(newdata.pred21)), ]) +

    geom_line(aes(x = x, y = y), linetype = 1, col = "blue", data = tab.ar1, size=1) +
      geom_point(shape = 20, alpha = 2, size=3) +

  geom_vline(xintercept = 12, linetype = "dashed", colour = "red") +
  geom_text(data = tab.labels, aes(x = x, y = y, label = text))
```

```{r}
newdata.pred25 <- newdata.pred27[925:938,]
```

```{r}
tab.ar1 <- data.frame(x = newdata.pred25$strdia.pred,
  y = newdata.pred25$RR.pred,
  ll95 = newdata.pred25$LL.pred,
  ul95 = newdata.pred25$UL.pred)

tab.labels <- data.frame(
  x = c(1, 14),
  y = c(10, 10),
  text = c("observed", "predicted")
)

ggplot(newdata.pred25, aes(x = strdia.pred, y = fallecidos.pred)) +
  xlab("Mes") +
  ylab("Prediccion fallecidos canton de Santa Ana, San Jose")+

  geom_ribbon(aes(x = x, y = y, ymin = ll95, ymax = ul95), fill="chocolate1", alpha = 0.75, data = tab.ar1) +
  geom_ribbon(aes(x = x, y = y, ymin = ll95, ymax = ul95), fill="chocolate1", alpha = 0.5, data = tab.ar1[-(1:nrow(newdata.pred21)), ]) +

    geom_line(aes(x = x, y = y), linetype = 1, col = "blue", data = tab.ar1, size=1) +
      geom_point(shape = 20, alpha = 2, size=3) +

  geom_vline(xintercept = 12, linetype = "dashed", colour = "red") +
  geom_text(data = tab.labels, aes(x = x, y = y, label = text))
```

```{r}
newdata.pred25 <- newdata.pred27[939:952,]
```

```{r}
tab.ar1 <- data.frame(x = newdata.pred25$strdia.pred,
  y = newdata.pred25$RR.pred,
  ll95 = newdata.pred25$LL.pred,
  ul95 = newdata.pred25$UL.pred)

tab.labels <- data.frame(
  x = c(1, 14),
  y = c(10, 10),
  text = c("observed", "predicted")
)

ggplot(newdata.pred25, aes(x = strdia.pred, y = fallecidos.pred)) +
  xlab("Mes") +
  ylab("Prediccion fallecidos canton de Santa Barbara, Heredia")+

  geom_ribbon(aes(x = x, y = y, ymin = ll95, ymax = ul95), fill="chocolate1", alpha = 0.75, data = tab.ar1) +
  geom_ribbon(aes(x = x, y = y, ymin = ll95, ymax = ul95), fill="chocolate1", alpha = 0.5, data = tab.ar1[-(1:nrow(newdata.pred21)), ]) +

    geom_line(aes(x = x, y = y), linetype = 1, col = "blue", data = tab.ar1, size=1) +
      geom_point(shape = 20, alpha = 2, size=3) +

  geom_vline(xintercept = 12, linetype = "dashed", colour = "red") +
  geom_text(data = tab.labels, aes(x = x, y = y, label = text))
```

```{r}
newdata.pred25 <- newdata.pred27[953:966,]
```

```{r}
tab.ar1 <- data.frame(x = newdata.pred25$strdia.pred,
  y = newdata.pred25$RR.pred,
  ll95 = newdata.pred25$LL.pred,
  ul95 = newdata.pred25$UL.pred)

tab.labels <- data.frame(
  x = c(1, 14),
  y = c(10, 10),
  text = c("observed", "predicted")
)

ggplot(newdata.pred25, aes(x = strdia.pred, y = fallecidos.pred)) +
  xlab("Mes") +
  ylab("Prediccion fallecidos canton de Santa Cruz, Guanacaste")+

  geom_ribbon(aes(x = x, y = y, ymin = ll95, ymax = ul95), fill="chocolate1", alpha = 0.75, data = tab.ar1) +
  geom_ribbon(aes(x = x, y = y, ymin = ll95, ymax = ul95), fill="chocolate1", alpha = 0.5, data = tab.ar1[-(1:nrow(newdata.pred21)), ]) +

    geom_line(aes(x = x, y = y), linetype = 1, col = "blue", data = tab.ar1, size=1) +
      geom_point(shape = 20, alpha = 2, size=3) +

  geom_vline(xintercept = 12, linetype = "dashed", colour = "red") +
  geom_text(data = tab.labels, aes(x = x, y = y, label = text))
```

```{r}
newdata.pred25 <- newdata.pred27[967:980,]
```

```{r}
tab.ar1 <- data.frame(x = newdata.pred25$strdia.pred,
  y = newdata.pred25$RR.pred,
  ll95 = newdata.pred25$LL.pred,
  ul95 = newdata.pred25$UL.pred)

tab.labels <- data.frame(
  x = c(1, 14),
  y = c(10, 10),
  text = c("observed", "predicted")
)

ggplot(newdata.pred25, aes(x = strdia.pred, y = fallecidos.pred)) +
  xlab("Mes") +
  ylab("Prediccion fallecidos canton de Santo Domingo, Heredia")+

  geom_ribbon(aes(x = x, y = y, ymin = ll95, ymax = ul95), fill="chocolate1", alpha = 0.75, data = tab.ar1) +
  geom_ribbon(aes(x = x, y = y, ymin = ll95, ymax = ul95), fill="chocolate1", alpha = 0.5, data = tab.ar1[-(1:nrow(newdata.pred21)), ]) +

    geom_line(aes(x = x, y = y), linetype = 1, col = "blue", data = tab.ar1, size=1) +
      geom_point(shape = 20, alpha = 2, size=3) +

  geom_vline(xintercept = 12, linetype = "dashed", colour = "red") +
  geom_text(data = tab.labels, aes(x = x, y = y, label = text))
```

```{r}
newdata.pred25 <- newdata.pred27[981:994,]
```

```{r}
tab.ar1 <- data.frame(x = newdata.pred25$strdia.pred,
  y = newdata.pred25$RR.pred,
  ll95 = newdata.pred25$LL.pred,
  ul95 = newdata.pred25$UL.pred)

tab.labels <- data.frame(
  x = c(1, 14),
  y = c(10, 10),
  text = c("observed", "predicted")
)

ggplot(newdata.pred25, aes(x = strdia.pred, y = fallecidos.pred)) +
  xlab("Mes") +
  ylab("Prediccion fallecidos canton de Sarapiqui, Heredia")+

  geom_ribbon(aes(x = x, y = y, ymin = ll95, ymax = ul95), fill="chocolate1", alpha = 0.75, data = tab.ar1) +
  geom_ribbon(aes(x = x, y = y, ymin = ll95, ymax = ul95), fill="chocolate1", alpha = 0.5, data = tab.ar1[-(1:nrow(newdata.pred21)), ]) +

    geom_line(aes(x = x, y = y), linetype = 1, col = "blue", data = tab.ar1, size=1) +
      geom_point(shape = 20, alpha = 2, size=3) +

  geom_vline(xintercept = 12, linetype = "dashed", colour = "red") +
  geom_text(data = tab.labels, aes(x = x, y = y, label = text))
```

```{r}
newdata.pred25 <- newdata.pred27[995:1008,]
```

```{r}
tab.ar1 <- data.frame(x = newdata.pred25$strdia.pred,
  y = newdata.pred25$RR.pred,
  ll95 = newdata.pred25$LL.pred,
  ul95 = newdata.pred25$UL.pred)

tab.labels <- data.frame(
  x = c(1, 14),
  y = c(10, 10),
  text = c("observed", "predicted")
)

ggplot(newdata.pred25, aes(x = strdia.pred, y = fallecidos.pred)) +
  xlab("Mes") +
  ylab("Prediccion fallecidos canton de Valverde Vega, Alajuela")+

  geom_ribbon(aes(x = x, y = y, ymin = ll95, ymax = ul95), fill="chocolate1", alpha = 0.75, data = tab.ar1) +
  geom_ribbon(aes(x = x, y = y, ymin = ll95, ymax = ul95), fill="chocolate1", alpha = 0.5, data = tab.ar1[-(1:nrow(newdata.pred21)), ]) +

    geom_line(aes(x = x, y = y), linetype = 1, col = "blue", data = tab.ar1, size=1) +
      geom_point(shape = 20, alpha = 2, size=3) +

  geom_vline(xintercept = 12, linetype = "dashed", colour = "red") +
  geom_text(data = tab.labels, aes(x = x, y = y, label = text))
```

```{r}
newdata.pred25 <- newdata.pred27[1009:1022,]
```

```{r}
tab.ar1 <- data.frame(x = newdata.pred25$strdia.pred,
  y = newdata.pred25$RR.pred,
  ll95 = newdata.pred25$LL.pred,
  ul95 = newdata.pred25$UL.pred)

tab.labels <- data.frame(
  x = c(1, 14),
  y = c(10, 10),
  text = c("observed", "predicted")
)

ggplot(newdata.pred25, aes(x = strdia.pred, y = fallecidos.pred)) +
  xlab("Mes") +
  ylab("Prediccion fallecidos canton de Siquirres, Limon")+

  geom_ribbon(aes(x = x, y = y, ymin = ll95, ymax = ul95), fill="chocolate1", alpha = 0.75, data = tab.ar1) +
  geom_ribbon(aes(x = x, y = y, ymin = ll95, ymax = ul95), fill="chocolate1", alpha = 0.5, data = tab.ar1[-(1:nrow(newdata.pred21)), ]) +

    geom_line(aes(x = x, y = y), linetype = 1, col = "blue", data = tab.ar1, size=1) +
      geom_point(shape = 20, alpha = 2, size=3) +

  geom_vline(xintercept = 12, linetype = "dashed", colour = "red") +
  geom_text(data = tab.labels, aes(x = x, y = y, label = text))
```

```{r}
newdata.pred25 <- newdata.pred27[1023:1036,]
```

```{r}
tab.ar1 <- data.frame(x = newdata.pred25$strdia.pred,
  y = newdata.pred25$RR.pred,
  ll95 = newdata.pred25$LL.pred,
  ul95 = newdata.pred25$UL.pred)

tab.labels <- data.frame(
  x = c(1, 14),
  y = c(10, 10),
  text = c("observed", "predicted")
)

ggplot(newdata.pred25, aes(x = strdia.pred, y = fallecidos.pred)) +
  xlab("Mes") +
  ylab("Prediccion fallecidos canton de Talamanca, Limon")+

  geom_ribbon(aes(x = x, y = y, ymin = ll95, ymax = ul95), fill="chocolate1", alpha = 0.75, data = tab.ar1) +
  geom_ribbon(aes(x = x, y = y, ymin = ll95, ymax = ul95), fill="chocolate1", alpha = 0.5, data = tab.ar1[-(1:nrow(newdata.pred21)), ]) +

    geom_line(aes(x = x, y = y), linetype = 1, col = "blue", data = tab.ar1, size=1) +
      geom_point(shape = 20, alpha = 2, size=3) +

  geom_vline(xintercept = 12, linetype = "dashed", colour = "red") +
  geom_text(data = tab.labels, aes(x = x, y = y, label = text))
```

```{r}
newdata.pred25 <- newdata.pred27[1037:1050,]
```

```{r}
tab.ar1 <- data.frame(x = newdata.pred25$strdia.pred,
  y = newdata.pred25$RR.pred,
  ll95 = newdata.pred25$LL.pred,
  ul95 = newdata.pred25$UL.pred)

tab.labels <- data.frame(
  x = c(1, 14),
  y = c(10, 10),
  text = c("observed", "predicted")
)

ggplot(newdata.pred25, aes(x = strdia.pred, y = fallecidos.pred)) +
  xlab("Mes") +
  ylab("Prediccion fallecidos canton de Tarrazu, San Jose")+

  geom_ribbon(aes(x = x, y = y, ymin = ll95, ymax = ul95), fill="chocolate1", alpha = 0.75, data = tab.ar1) +
  geom_ribbon(aes(x = x, y = y, ymin = ll95, ymax = ul95), fill="chocolate1", alpha = 0.5, data = tab.ar1[-(1:nrow(newdata.pred21)), ]) +

    geom_line(aes(x = x, y = y), linetype = 1, col = "blue", data = tab.ar1, size=1) +
      geom_point(shape = 20, alpha = 2, size=3) +

  geom_vline(xintercept = 12, linetype = "dashed", colour = "red") +
  geom_text(data = tab.labels, aes(x = x, y = y, label = text))
```

```{r}
newdata.pred25 <- newdata.pred27[1051:1064,]
```

```{r}
tab.ar1 <- data.frame(x = newdata.pred25$strdia.pred,
  y = newdata.pred25$RR.pred,
  ll95 = newdata.pred25$LL.pred,
  ul95 = newdata.pred25$UL.pred)

tab.labels <- data.frame(
  x = c(1, 14),
  y = c(10, 10),
  text = c("observed", "predicted")
)

ggplot(newdata.pred25, aes(x = strdia.pred, y = fallecidos.pred)) +
  xlab("Mes") +
  ylab("Prediccion fallecidos canton de Tibas, San Jose")+

  geom_ribbon(aes(x = x, y = y, ymin = ll95, ymax = ul95), fill="chocolate1", alpha = 0.75, data = tab.ar1) +
  geom_ribbon(aes(x = x, y = y, ymin = ll95, ymax = ul95), fill="chocolate1", alpha = 0.5, data = tab.ar1[-(1:nrow(newdata.pred21)), ]) +

    geom_line(aes(x = x, y = y), linetype = 1, col = "blue", data = tab.ar1, size=1) +
      geom_point(shape = 20, alpha = 2, size=3) +

  geom_vline(xintercept = 12, linetype = "dashed", colour = "red") +
  geom_text(data = tab.labels, aes(x = x, y = y, label = text))
```

```{r}
newdata.pred25 <- newdata.pred27[1065:1078,]
```

```{r}
tab.ar1 <- data.frame(x = newdata.pred25$strdia.pred,
  y = newdata.pred25$RR.pred,
  ll95 = newdata.pred25$LL.pred,
  ul95 = newdata.pred25$UL.pred)

tab.labels <- data.frame(
  x = c(1, 14),
  y = c(10, 10),
  text = c("observed", "predicted")
)

ggplot(newdata.pred25, aes(x = strdia.pred, y = fallecidos.pred)) +
  xlab("Mes") +
  ylab("Prediccion fallecidos canton de Tilaran, Guanacaste")+

  geom_ribbon(aes(x = x, y = y, ymin = ll95, ymax = ul95), fill="chocolate1", alpha = 0.75, data = tab.ar1) +
  geom_ribbon(aes(x = x, y = y, ymin = ll95, ymax = ul95), fill="chocolate1", alpha = 0.5, data = tab.ar1[-(1:nrow(newdata.pred21)), ]) +

    geom_line(aes(x = x, y = y), linetype = 1, col = "blue", data = tab.ar1, size=1) +
      geom_point(shape = 20, alpha = 2, size=3) +

  geom_vline(xintercept = 12, linetype = "dashed", colour = "red") +
  geom_text(data = tab.labels, aes(x = x, y = y, label = text))
```

```{r}
newdata.pred25 <- newdata.pred27[1079:1092,]
```

```{r}
tab.ar1 <- data.frame(x = newdata.pred25$strdia.pred,
  y = newdata.pred25$RR.pred,
  ll95 = newdata.pred25$LL.pred,
  ul95 = newdata.pred25$UL.pred)

tab.labels <- data.frame(
  x = c(1, 14),
  y = c(10, 10),
  text = c("observed", "predicted")
)

ggplot(newdata.pred25, aes(x = strdia.pred, y = fallecidos.pred)) +
  xlab("Mes") +
  ylab("Prediccion fallecidos canton de Turrialba, Cartago")+

  geom_ribbon(aes(x = x, y = y, ymin = ll95, ymax = ul95), fill="chocolate1", alpha = 0.75, data = tab.ar1) +
  geom_ribbon(aes(x = x, y = y, ymin = ll95, ymax = ul95), fill="chocolate1", alpha = 0.5, data = tab.ar1[-(1:nrow(newdata.pred21)), ]) +

    geom_line(aes(x = x, y = y), linetype = 1, col = "blue", data = tab.ar1, size=1) +
      geom_point(shape = 20, alpha = 2, size=3) +

  geom_vline(xintercept = 12, linetype = "dashed", colour = "red") +
  geom_text(data = tab.labels, aes(x = x, y = y, label = text))
```

```{r}
newdata.pred25 <- newdata.pred27[1093:1106,]
```

```{r}
tab.ar1 <- data.frame(x = newdata.pred25$strdia.pred,
  y = newdata.pred25$RR.pred,
  ll95 = newdata.pred25$LL.pred,
  ul95 = newdata.pred25$UL.pred)

tab.labels <- data.frame(
  x = c(1, 14),
  y = c(10, 10),
  text = c("observed", "predicted")
)

ggplot(newdata.pred25, aes(x = strdia.pred, y = fallecidos.pred)) +
  xlab("Mes") +
  ylab("Prediccion fallecidos canton de Turrubares, San Jose")+

  geom_ribbon(aes(x = x, y = y, ymin = ll95, ymax = ul95), fill="chocolate1", alpha = 0.75, data = tab.ar1) +
  geom_ribbon(aes(x = x, y = y, ymin = ll95, ymax = ul95), fill="chocolate1", alpha = 0.5, data = tab.ar1[-(1:nrow(newdata.pred21)), ]) +

    geom_line(aes(x = x, y = y), linetype = 1, col = "blue", data = tab.ar1, size=1) +
      geom_point(shape = 20, alpha = 2, size=3) +

  geom_vline(xintercept = 12, linetype = "dashed", colour = "red") +
  geom_text(data = tab.labels, aes(x = x, y = y, label = text))
```

```{r}
newdata.pred25 <- newdata.pred27[1107:1120,]
```

```{r}
tab.ar1 <- data.frame(x = newdata.pred25$strdia.pred,
  y = newdata.pred25$RR.pred,
  ll95 = newdata.pred25$LL.pred,
  ul95 = newdata.pred25$UL.pred)

tab.labels <- data.frame(
  x = c(1, 14),
  y = c(10, 10),
  text = c("observed", "predicted")
)

ggplot(newdata.pred25, aes(x = strdia.pred, y = fallecidos.pred)) +
  xlab("Mes") +
  ylab("Prediccion fallecidos canton de Upala, San Jose")+

  geom_ribbon(aes(x = x, y = y, ymin = ll95, ymax = ul95), fill="chocolate1", alpha = 0.75, data = tab.ar1) +
  geom_ribbon(aes(x = x, y = y, ymin = ll95, ymax = ul95), fill="chocolate1", alpha = 0.5, data = tab.ar1[-(1:nrow(newdata.pred21)), ]) +

    geom_line(aes(x = x, y = y), linetype = 1, col = "blue", data = tab.ar1, size=1) +
      geom_point(shape = 20, alpha = 2, size=3) +

  geom_vline(xintercept = 12, linetype = "dashed", colour = "red") +
  geom_text(data = tab.labels, aes(x = x, y = y, label = text))
```

```{r}
newdata.pred25 <- newdata.pred27[1121:1134,]
```

```{r}
tab.ar1 <- data.frame(x = newdata.pred25$strdia.pred,
  y = newdata.pred25$RR.pred,
  ll95 = newdata.pred25$LL.pred,
  ul95 = newdata.pred25$UL.pred)

tab.labels <- data.frame(
  x = c(1, 14),
  y = c(10, 10),
  text = c("observed", "predicted")
)

ggplot(newdata.pred25, aes(x = strdia.pred, y = fallecidos.pred)) +
  xlab("Mes") +
  ylab("Prediccion fallecidos canton de Vasquez de Coronado, San Jose")+

  geom_ribbon(aes(x = x, y = y, ymin = ll95, ymax = ul95), fill="chocolate1", alpha = 0.75, data = tab.ar1) +
  geom_ribbon(aes(x = x, y = y, ymin = ll95, ymax = ul95), fill="chocolate1", alpha = 0.5, data = tab.ar1[-(1:nrow(newdata.pred21)), ]) +

    geom_line(aes(x = x, y = y), linetype = 1, col = "blue", data = tab.ar1, size=1) +
      geom_point(shape = 20, alpha = 2, size=3) +

  geom_vline(xintercept = 12, linetype = "dashed", colour = "red") +
  geom_text(data = tab.labels, aes(x = x, y = y, label = text))
```

```{r}
newdata.pred25 <- newdata.pred27[1135:1148,]
```

```{r}
tab.ar1 <- data.frame(x = newdata.pred25$strdia.pred,
  y = newdata.pred25$RR.pred,
  ll95 = newdata.pred25$LL.pred,
  ul95 = newdata.pred25$UL.pred)

tab.labels <- data.frame(
  x = c(1, 14),
  y = c(10, 10),
  text = c("observed", "predicted")
)

ggplot(newdata.pred25, aes(x = strdia.pred, y = fallecidos.pred)) +
  xlab("Mes") +
  ylab("Prediccion fallecidos canton de Zarcero, Alajuela")+

  geom_ribbon(aes(x = x, y = y, ymin = ll95, ymax = ul95), fill="chocolate1", alpha = 0.75, data = tab.ar1) +
  geom_ribbon(aes(x = x, y = y, ymin = ll95, ymax = ul95), fill="chocolate1", alpha = 0.5, data = tab.ar1[-(1:nrow(newdata.pred21)), ]) +

    geom_line(aes(x = x, y = y), linetype = 1, col = "blue", data = tab.ar1, size=1) +
      geom_point(shape = 20, alpha = 2, size=3) +

  geom_vline(xintercept = 12, linetype = "dashed", colour = "red") +
  geom_text(data = tab.labels, aes(x = x, y = y, label = text))
```




<!-- ```{r} -->
<!-- predict1 <- res62.pred$summary.fitted.values %>% dplyr::select(mean,`0.025quant`,`0.975quant`, sd) -->
<!-- predict1 -->
<!-- ``` -->


<!-- ```{r} -->
<!-- summary(predict1) -->
<!-- ``` -->



<!-- ```{r} -->
<!-- predict.rrisk <- res62.pred$summary.linear.predictor %>% dplyr::select(mean,`0.025quant`,`0.975quant`, sd) -->
<!-- predict.rrisk -->
<!-- ``` -->

<!-- ```{r} -->
<!-- summary(predict.rrisk) -->
<!-- ``` -->

<!-- ```{r} -->
<!-- ## ----------------------------------------------------------------------------- -->
<!-- #quake.pred <- rbind(earthquake,  -->
<!--  # data.frame(number = rep(NA, 14), year = 2007:2020)) -->


<!-- ## ----------------------------------------------------------------------------- -->
<!-- #quake.ar1.pred <- inla(number ~ 1 + f(year, model = "ar1"), data = quake.pred, -->
<!--  # family = "poisson", control.predictor = list(compute = TRUE, link = 1)) -->
<!-- #summary(quake.ar1.pred) -->

<!-- # numcanton2.pred <- new.speeds$numcanton.pred -->
<!-- # strdia2.pred <- new.speeds$strdia.pred -->
<!-- # formula62.pred <- (fallecidos.pred~SMR.anterior.pred+ -->
<!-- #                              f(numcanton.pred, model="bym",graph=g) + -->
<!-- #                              f(strdia.pred, model="rw2") + -->
<!-- #                              f(strdiaint.pred, model="ar1")+ -->
<!-- #                               f(numcanton2.pred, model="ar1", group=strdia2.pred, -->
<!-- #                                control.group=list(model="rw2"))) -->
<!-- #  -->
<!-- #  -->
<!-- # res62.pred <- inla(formula62.pred, family = "poisson", data = new.speeds, E = Expected, control.compute = list(dic = T, waic=T, cpo=T, return.marginals.predictor=TRUE), control.predictor = list(compute = TRUE, link = 1),control.inla=list(strategy="laplace")) -->
<!-- # summary(res62.pred) -->

<!-- ## ----label = "quakepred", fig = TRUE, echo = FALSE, fig.cap = "Prediction from the earthquake dataset from 2007 to 2020.", fig.width = 6, fig.height = 4---- -->
<!-- tab.ar1 <- data.frame(x = new.speeds$strdia.pred, -->
<!--   y = res62.pred$summary.fitted.values[, "mean"], -->
<!--   ll95 = res62.pred$summary.fitted.values[, "0.025quant"], -->
<!--   ul95 = res62.pred$summary.fitted.values[, "0.975quant"]) -->

<!-- tab.labels <- data.frame( -->
<!--   x = c(1, 13), -->
<!--   y = c(100, 100), -->
<!--   text = c("observed", "predicted") -->
<!-- ) -->

<!-- ggplot(new.speeds, aes(x = strdia2.pred, y = fallecidos.pred)) + -->
<!--   geom_point(shape = 20, alpha = 0.3) + -->
<!--   xlab("Year") + -->
<!--   ylab("Number of major earthquakes")+ -->
<!--   geom_line(aes(x = x, y = y), linetype = 1, col = "blue", data = tab.ar1) + -->
<!--   geom_ribbon(aes(x = x, y = y, ymin = ll95, ymax = ul95), alpha = 0.75, data = tab.ar1) + -->
<!--   geom_ribbon(aes(x = x, y = y, ymin = ll95, ymax = ul95), alpha = 0.5, data = tab.ar1[-(1:nrow(new.speeds)), ]) + -->
<!--   geom_vline(xintercept = 12, linetype = "dashed", colour = "red") + -->
<!--   geom_text(data = tab.labels, aes(x = x, y = y, label = text)) -->

<!-- ``` -->









